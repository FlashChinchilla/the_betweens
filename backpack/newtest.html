<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <title>The Ring Between Two Yangons - Director's Cut</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/lucide@latest"></script>
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
        
        <!-- MapLibre GL (Free Mapbox Fork - No Token Required, No Watermark) -->
        <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
        <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
        
        <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&family=Noto+Sans+Myanmar:wght@300;400;500;600;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Special+Elite&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

        :root {
            --bg-real: #fdf6e3;
            --bg-parallel: #0f172a;
            --accent-gold: #eab308;
            --glass-bg: rgba(10, 10, 10, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Lato', 'Noto Sans Myanmar', sans-serif;
            overflow: hidden;
            background-color: #050505;
            color: #e2e8f0;
            touch-action: manipulation;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        /* --- VISUAL FX ENGINE V5 --- */
        .world-real { filter: sepia(0.15) saturate(1.1) brightness(1.05); transition: filter 3s ease-in-out; }
        .world-parallel { filter: hue-rotate(210deg) saturate(0.4) contrast(1.4) brightness(0.7) drop-shadow(0 0 20px rgba(0,100,255,0.1)); transition: filter 3s ease-in-out; }
        .world-collapse { animation: glitch-anim 0.1s infinite; filter: contrast(1.5) grayscale(1); }
        .world-dream { filter: blur(1px) brightness(1.2) saturate(1.5); transition: filter 3s ease; }
        .world-flash { animation: flash-anim 0.5s ease-out; }

        @keyframes panZoom {
            0% { transform: scale(1.0) translate(0, 0); }
            50% { transform: scale(1.05) translate(-1%, 1%); }
            100% { transform: scale(1.0) translate(0, 0); }
        }
        .camera-move { animation: panZoom 60s infinite ease-in-out alternate; }
        .static-cam { animation: none !important; transform: scale(1.0) translate(0, 0) !important; transition: transform 0.5s ease-out; }
        #camera-rig { filter: brightness(1.1); transition: filter 1s ease; }

        @keyframes glitch-anim {
            0% { transform: translate(0) }
            20% { transform: translate(-3px, 3px) }
            40% { transform: translate(-3px, -3px) }
            60% { transform: translate(3px, 3px) }
            80% { transform: translate(3px, -3px) }
            100% { transform: translate(0) }
        }

        @keyframes flash-anim {
            0% { background-color: white; opacity: 1; }
            100% { background-color: transparent; opacity: 0; }
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes bounce-pin {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .fade-in { animation: fadeIn 1s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* --- MODERN UI SYSTEM --- */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5);
            transition: background 0.3s, border-color 0.3s, color 0.3s;
        }

        .scanlines {
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 3px;
            position: absolute; inset: 0; pointer-events: none; z-index: 50; opacity: 0.3;
        }

        .dialogue-box {
            background-color: rgba(10, 10, 10, 0.6);
            backdrop-filter: blur(20px) saturate(1.8);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-left: 1px solid rgba(255, 255, 255, 0.05);
            border-right: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 24px;
            box-shadow: 0 -20px 60px rgba(0,0,0,0.8);
            transition: background-color 0.3s, border-color 0.3s;
        }

        .choice-btn {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border-left: 3px solid rgba(255, 255, 255, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .choice-btn:active, .choice-btn:hover {
            transform: translateX(12px);
            background: linear-gradient(90deg, rgba(234, 179, 8, 0.1), transparent);
            border-left-color: var(--accent-gold);
            padding-left: 24px;
        }

        /* Modern HUD Buttons */
        .hud-btn {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: rgba(20, 20, 20, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #94a3b8;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            backdrop-filter: blur(8px);
        }
        
        .hud-btn::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, rgba(234, 179, 8, 0.2) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .hud-btn:hover {
            background: rgba(234, 179, 8, 0.9);
            color: #000;
            border-color: #facc15;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(234, 179, 8, 0.25);
        }
        
        .hud-btn:hover::after { opacity: 1; }
        .hud-btn:active { transform: scale(0.95); }
        
        .hud-btn.active-mode {
            background: #eab308;
            color: black;
            box-shadow: 0 0 15px rgba(234, 179, 8, 0.4);
        }

        /* Tooltip */
        .hud-btn .tooltip {
            position: absolute;
            top: 110%;
            left: 50%;
            transform: translateX(-50%) translateY(-10px);
            background: rgba(0,0,0,0.9);
            color: #eab308;
            padding: 4px 8px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 4px;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
            white-space: nowrap;
            border: 1px solid rgba(234, 179, 8, 0.3);
        }
        .hud-btn:hover .tooltip {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .cursor::after { content: 'â–‹'; animation: blink 1s infinite; color: #eab308; margin-left: 2px;}
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #eab308; border-radius: 4px; }

        /* --- MAP STYLES ENHANCED --- */
        .map-viewport { position: relative; width: 100%; height: 100%; flex: 1; overflow: hidden; background-color: #f1f5f9; }
        .map-pin { transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .pin-bounce { animation: bounce-pin 2s infinite ease-in-out; }
        .locked-location { filter: grayscale(1); cursor: not-allowed; }
        
        /* Hide Mapbox/MapLibre Watermarks */
        .maplibregl-ctrl-attrib, .maplibregl-ctrl-logo, .mapboxgl-ctrl-attrib, .mapboxgl-ctrl-logo { display: none !important; }

        .notification-toast { transform: translateX(120%); transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .notification-show { transform: translateX(0%) !important; }
        
        /* Dynamic Map Pins */
        .map-pin-wrapper { display: flex; flex-direction: column; align-items: center; pointer-events: auto; }
        .map-pin-unlocked { z-index: 20; cursor: pointer; transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .map-pin-unlocked:hover { transform: scale(1.15) translateY(-4px); z-index: 100; }
        .map-pin-locked { z-index: 10; cursor: not-allowed; opacity: 0.8; }
        
        .map-player-indicator { position: absolute; top: -3.5rem; z-index: 50; animation: bounce 1.5s infinite; }
        .map-player-avatar { width: 2.75rem; height: 2.75rem; border-radius: 50%; border: 3px solid #3b82f6; box-shadow: 0 0 15px rgba(59,130,246,0.5); background-color: white; padding: 2px; object-fit: cover; }
        .map-player-arrow { position: absolute; bottom: -0.3rem; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 6px solid transparent; border-right: 6px solid transparent; border-top: 6px solid #3b82f6; }
        
        .map-pin-icon-wrapper { position: relative; padding-bottom: 6px; }
        .map-pin-shadow { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); width: 2rem; height: 0.5rem; background-color: rgba(0,0,0,0.2); border-radius: 50%; filter: blur(2px); transition: all 0.3s ease; }
        .map-pin-unlocked:hover .map-pin-shadow { width: 1.5rem; transform: translateX(-50%) translateY(4px); background-color: rgba(0,0,0,0.1); }
        .map-pin-img { width: 3rem; height: 3rem; object-fit: contain; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.15)); transition: all 0.3s ease; }
        
        .map-pin-label { position: absolute; top: 100%; left: 50%; transform: translateX(-50%) translateY(4px); background-color: rgba(255,255,255,0.95); backdrop-filter: blur(4px); color: #0f172a; font-size: 0.75rem; padding: 0.35rem 0.75rem; font-weight: 700; border-radius: 0.5rem; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05); opacity: 0; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); white-space: nowrap; border: 1px solid rgba(226,232,240,0.8); z-index: 50; pointer-events: none; }
        .map-pin-wrapper:hover .map-pin-label { opacity: 1; transform: translateX(-50%) translateY(8px); }
        
        .map-pin-locked-wrap { position: relative; filter: grayscale(50%) opacity(100%); transition: all 0.3s ease; padding-bottom: 6px; }
        .map-pin-locked:hover .map-pin-locked-wrap { filter: grayscale(0%) opacity(100%); }
        .map-pin-locked-img { width: 2.75rem; height: 2.75rem; object-fit: contain; }
        .map-pin-lock-icon { position: absolute; top: -0.25rem; right: -0.25rem; background-color: #ef4444; border-radius: 50%; padding: 0.2rem; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); z-index: 10; width: 1.25rem; height: 1.25rem; color: white; display: flex; justify-content: center; align-items: center; }
        .map-pin-locked-label { position: absolute; top: 100%; left: 50%; transform: translateX(-50%) translateY(4px); background-color: rgba(241,245,249,0.95); color: #64748b; font-size: 0.75rem; padding: 0.35rem 0.75rem; font-weight: 600; border-radius: 0.5rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); white-space: nowrap; border: 1px solid rgba(203,213,225,0.8); z-index: 50; pointer-events: none; opacity: 1; }

        /* Phone & Currency Styles */
        .phone-modal-container { perspective: 1000px; }
        .phone-screen { box-shadow: 0 0 20px rgba(0,0,0,0.8), inset 0 0 10px rgba(255,255,255,0.1); }
        .app-icon { transition: transform 0.1s; }
        .app-icon:active { transform: scale(0.9); filter: brightness(0.8); }
        .currency-positive { color: #4ade80; text-shadow: 0 0 10px rgba(74, 222, 128, 0.5); }
        .currency-negative { color: #f87171; text-shadow: 0 0 10px rgba(248, 113, 113, 0.5); }
        
        .app-screen-enter { transform: translateX(100%); }
        .app-screen-active { transform: translateX(0%); }
        .app-screen-exit { transform: translateX(100%); }

        /* --- MAIN MENU STYLES --- */
        .menu-item {
            position: relative;
            padding: 14px 0;
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            letter-spacing: 0.15em;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            cursor: pointer;
            width: 100%;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .menu-item::before {
            content: '';
            position: absolute;
            left: 0;
            bottom: 0;
            width: 0;
            height: 1px;
            background: var(--accent-gold);
            transition: width 0.4s ease;
            box-shadow: 0 0 8px var(--accent-gold);
        }

        .menu-item:hover { color: #fff; padding-left: 20px; text-shadow: 0 0 15px rgba(234, 179, 8, 0.6); border-bottom-color: transparent; }
        .menu-item:hover::before { width: 100%; }
        .menu-item .icon-box { opacity: 0; transform: translateX(-10px); transition: all 0.3s ease; color: var(--accent-gold); }
        .menu-item:hover .icon-box { opacity: 1; transform: translateX(0); }
        .menu-item.primary { font-size: 1.4rem; color: var(--accent-gold); font-weight: 700; margin-bottom: 10px; border-bottom: 1px solid rgba(234, 179, 8, 0.3); }
        .menu-item.primary:hover { color: #fff; background: linear-gradient(90deg, rgba(234, 179, 8, 0.15), transparent); }

        .animate-slide-up { animation: slideUpFade 0.8s backwards; }
        
        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .menu-grain {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1; opacity: 0.05;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* --- DYNAMIC SETTINGS STYLES --- */
        /* Font Size System */
        body.font-sm #dialogue-text { font-size: 0.875rem !important; line-height: 1.5rem !important; }
        body.font-sm .choice-btn { font-size: 0.875rem !important; }
        body.font-lg #dialogue-text { font-size: 1.5rem !important; line-height: 2.25rem !important; }
        body.font-lg .choice-btn { font-size: 1.125rem !important; }
        
        /* Graphics System */
        body.gfx-low .glass-panel, body.gfx-low .dialogue-box { backdrop-filter: none !important; -webkit-backdrop-filter: none !important; background-color: rgba(15,15,15,0.95) !important; box-shadow: none !important;}
        body.gfx-low .scanlines, body.gfx-low #rain-layer, body.gfx-low .menu-grain { display: none !important; }
        body.gfx-low .camera-move { animation: none !important; transform: scale(1.0) !important; }
        body.gfx-low .world-real { filter: brightness(1.1) !important; }
        body.gfx-low .world-parallel { filter: brightness(0.7) !important; }
        body.gfx-low .world-collapse { animation: none !important; filter: contrast(1.2) grayscale(1) !important; }
        body.gfx-low #camera-rig { filter: saturate(0.8) blur(1px); }
        
        body.gfx-med .glass-panel, body.gfx-med .dialogue-box { backdrop-filter: blur(4px) !important; -webkit-backdrop-filter: blur(4px) !important; }
        body.gfx-med .camera-move { animation-duration: 120s !important; }
        body.gfx-med #camera-rig { filter: saturate(1); }

        body.gfx-high #camera-rig { filter: saturate(1.2) contrast(1.05); }

        /* Light Theme Overrides (Global Game Elements) */
        body.theme-light { background-color: #f1f5f9; color: #1e293b; }
        body.theme-light #start-screen .bg-black { background-color: #f8fafc; }
        body.theme-light #start-screen .bg-gradient-to-r { background: linear-gradient(to right, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 40%, rgba(255,255,255,0.2) 100%); }
        body.theme-light #start-screen h1 { -webkit-text-fill-color: #0f172a; text-shadow: 0px 4px 10px rgba(255,255,255,0.8); }
        body.theme-light #start-screen .text-gray-300 { color: #334155 !important; }
        body.theme-light #start-screen .text-gray-500 { color: #64748b !important; }
        body.theme-light .menu-item { color: #475569; }
        body.theme-light .menu-item:hover { color: #0f172a; text-shadow: none; }
        body.theme-light .menu-item.primary { color: #ca8a04; }
        body.theme-light .menu-item::before { background: #ca8a04; box-shadow: none; }
        
        body.theme-light .glass-panel, body.theme-light .dialogue-box { 
            background: rgba(255, 255, 255, 0.85) !important; 
            border-color: rgba(0, 0, 0, 0.1) !important; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.1) !important;
        }
        body.theme-light #dialogue-text { color: #0f172a !important; text-shadow: none; }
        body.theme-light .choice-btn { background: rgba(0,0,0,0.03); color: #1e293b; border-left-color: rgba(0,0,0,0.1); border-bottom-color: rgba(0,0,0,0.05); }
        body.theme-light .choice-btn:hover { background: rgba(234, 179, 8, 0.15); border-left-color: #ca8a04; }
        body.theme-light .hud-btn { background: rgba(255,255,255,0.7); color: #475569; border-color: rgba(0,0,0,0.1); }
        body.theme-light .hud-btn:hover { background: #ca8a04; color: #fff; border-color: #ca8a04; }
        body.theme-light .hud-btn.active-mode { background: #ca8a04; color: #fff; }
        body.theme-light #speaker-box { background-color: #f8fafc; color: #ca8a04; border-color: #ca8a04; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        /* --- APPLE iOS 26 LIQUID GLASSMORPHISM SETTINGS --- */
        .ios-glass {
            background: rgba(30, 30, 30, 0.55);
            backdrop-filter: blur(40px) saturate(200%);
            -webkit-backdrop-filter: blur(40px) saturate(200%);
            border: 1px solid rgba(255, 255, 0, 0.099);
            box-shadow: 0 40px 80px rgba(0,0,0,0.5), inset 0 1px 1px rgba(255,255,255,0.1);
            color: rgba(255, 255, 255, 0.9);
        }
        body.theme-light .ios-glass {
            background: rgba(250, 250, 250, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 40px 80px rgba(0,0,0,0.15), inset 0 1px 1px rgba(255,255,255,0.8);
            color: #1c1c1e;
        }

        .ios-glass-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        body.theme-light .ios-glass-header {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .ios-segmented-control {
            background: rgba(0, 0, 0, 0.25);
            border-radius: 16px;
            padding: 4px;
            box-shadow: inset 0 1px 5px rgba(0,0,0,0.3);
        }
        body.theme-light .ios-segmented-control {
            background: rgba(118, 118, 128, 0.12);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }

        .ios-segment-btn {
            position: relative;
            z-index: 1;
            transition: color 0.4s ease, transform 0.2s cubic-bezier(0.2, 0, 0, 1);
            border-radius: 12px;
            overflow: hidden;
            color: rgba(255, 255, 255, 0.6);
            font-weight: 500;
        }
        body.theme-light .ios-segment-btn {
            color: rgba(0, 0, 0, 0.6);
        }

        /* Water Drop Hover Effect */
        .ios-segment-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            border-radius: 50%;
            opacity: 0;
            transition: width 0.5s ease-out, height 0.5s ease-out, opacity 0.5s ease-out;
            z-index: -1;
            pointer-events: none;
        }
        body.theme-light .ios-segment-btn::before {
            background: radial-gradient(circle, rgba(0,0,0,0.08) 0%, transparent 70%);
        }
        .ios-segment-btn:hover:not(.st-btn-active)::before {
            width: 200%;
            height: 200%;
            padding-top: 200%;
            opacity: 1;
        }

        /* Active State Pill */
        .ios-segment-btn.st-btn-active {
            color: #ffffff;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2), inset 0 1px 1px rgba(255,255,255,0.1);
        }
        body.theme-light .ios-segment-btn.st-btn-active {
            color: #000000;
            background: #ffffff;
            box-shadow: 0 3px 8px rgba(0,0,0,0.12), inset 0 1px 1px rgba(255,255,255,1);
        }

        /* iOS Slider */
        .ios-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            outline: none;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }
        body.theme-light .ios-slider {
            background: rgba(0,0,0,0.1);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .ios-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #ffffff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3), 0 0 0 1px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.3s cubic-bezier(0.2, 0, 0, 1), box-shadow 0.3s;
        }
        body.theme-light .ios-slider::-webkit-slider-thumb {
            box-shadow: 0 2px 8px rgba(0,0,0,0.2), 0 0 0 1px rgba(0,0,0,0.02);
        }
        .ios-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4), 0 0 0 1px rgba(0,0,0,0.05);
        }

        /* Tooltip Adjustments for Glass */
        .tooltip-content {
            background: rgba(15, 15, 15, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.15);
            box-shadow: 0 15px 35px rgba(0,0,0,0.6);
            color: rgba(255,255,255,0.9);
        }
        body.theme-light .tooltip-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(0,0,0,0.1);
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            color: #1c1c1e;
        }

        /* Close Button */
        .ios-close-btn {
            background: rgba(255,255,255,0.1);
            color: rgba(255,255,255,0.8);
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.2, 0, 0, 1);
        }
        body.theme-light .ios-close-btn {
            background: rgba(0,0,0,0.05);
            color: rgba(0,0,0,0.6);
        }
        .ios-close-btn:hover {
            background: rgba(255,255,255,0.2);
            color: #fff;
            transform: scale(1.1) rotate(90deg);
        }
        body.theme-light .ios-close-btn:hover {
            background: rgba(0,0,0,0.1);
            color: #000;
        }

        /* Preloader Shimmer Effect */
        @keyframes shimmer-load {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .loading-shimmer {
            background: linear-gradient(90deg, rgba(234,179,8,0.5) 0%, rgba(250,204,21,1) 50%, rgba(234,179,8,0.5) 100%);
            background-size: 200% 100%;
            animation: shimmer-load 2s infinite linear;
        }
        </style>
    </head>
    <body class="text-gray-100 h-screen w-screen relative select-none bg-black transition-colors duration-1000">

        <!-- Preloader Screen -->
        <div id="preloader-screen" class="fixed inset-0 z-[200] bg-[#050505] flex flex-col items-center justify-center text-center p-6 transition-opacity duration-1000">
            
            <div class="flex gap-12 mb-10">
                <div class="flex flex-col items-center gap-4 transition-transform hover:scale-105">
                    <img src="https://us.technics.com/cdn/shop/files/EAH-A800_NonTextCarousels_01_2000x2000_aa2eef2b-7bd7-4800-936b-100d796ceb13_1800x.jpg?v=1745873069" alt="Headphones Placeholder" class="w-24 h-24 object-cover rounded-full border border-yellow-500/30 shadow-[0_0_20px_rgba(234,179,8,0.15)] opacity-1">
                    <span class="text-xs uppercase tracking-[0.2em] font-bold text-gray-500">Headphones</span>
                </div>
            </div>
            
            <div class="max-w-md mb-12">
                <h2 class="text-xl md:text-2xl font-cinzel font-bold text-gray-200 tracking-widest mb-3 uppercase">USE HEADPHONES FOR THE BEST EXPERIENCE</h2>
                <p class="text-gray-400 text-sm md:text-base leading-relaxed font-lato">
                    Recommended Device - Laptop, Desktop, Tablet
                </p>
            </div>

            <div class="w-64 h-1 bg-gray-900 rounded-full overflow-hidden shadow-inner relative mb-4">
                <div id="loading-bar-fill" class="h-full w-0 loading-shimmer shadow-[0_0_10px_rgba(234,179,8,0.8)] transition-all duration-300"></div>
            </div>
            
            <div class="flex items-center gap-3">
                <i id="loading-spinner" data-lucide="loader-2" class="w-4 h-4 text-yellow-500 animate-spin"></i>
                <div id="loading-text" class="text-xs font-mono text-yellow-500/80 tracking-[0.2em] uppercase">Initializing... 0%</div>
            </div>
            
            <button id="start-btn" class="hidden mt-10 px-10 py-3 bg-transparent border border-yellow-500 text-yellow-500 font-bold tracking-[0.2em] uppercase text-sm rounded hover:bg-yellow-500 hover:text-black transition-all duration-300 shadow-[0_0_15px_rgba(234,179,8,0.2)] hover:shadow-[0_0_25px_rgba(234,179,8,0.5)]" onclick="game.startFromPreloader()">Play</button>
        </div>

        <div id="game-container" class="relative w-full h-full overflow-hidden">
            

            <!-- Background System -->
            <div id="background-wrapper"
                class="absolute inset-0 overflow-hidden bg-black transition-colors duration-1000">
                <div id="camera-rig"
                    class="absolute inset-0 w-full h-full camera-move">
                    <div id="bg-layer-1"
                        class="absolute inset-0 w-full h-full bg-cover bg-center transition-opacity duration-[2000ms] ease-in-out opacity-0 z-0"></div>
                    <div id="bg-layer-2"
                        class="absolute inset-0 w-full h-full bg-cover bg-center transition-opacity duration-[2000ms] ease-in-out opacity-0 z-0"></div>
                </div>
                <div id="mood-layer"
                    class="absolute inset-0 bg-black/20 mix-blend-overlay transition-colors duration-1000 z-10"></div>
            </div>

            <!-- Overlays -->
            <div class="scanlines"></div>
            <div class="vignette"></div>
            <div id="rain-layer"
                class="absolute inset-0 pointer-events-none hidden bg-[url('https://i.gifer.com/7scx.gif')] opacity-20 bg-cover mix-blend-screen z-30"></div>
            <div id="flash-layer"
                class="absolute inset-0 bg-white opacity-0 pointer-events-none z-50"></div>

            <!-- Character -->
            <div id="character-layer"
                class="absolute inset-0 flex items-end justify-center pointer-events-none z-20 pb-0 transition-transform duration-700 translate-y-10 opacity-0">
            </div>
            
            <!-- Map Modal Overlay -->
            <div id="map-modal" class="hidden absolute inset-0 z-[100] bg-slate-900/80 flex items-center justify-center p-4 md:p-6 backdrop-blur-lg transition-all duration-300 opacity-0">
                <div class="relative w-full max-w-6xl h-[85vh] bg-slate-50 rounded-[2rem] overflow-hidden shadow-[0_20px_50px_rgba(0,0,0,0.5)] ring-1 ring-white/20 group font-roboto text-gray-800 flex flex-col">
                    
                    <!-- Search Bar & Menu -->
                    <div class="absolute top-6 left-6 right-20 md:right-auto md:w-96 z-[60] flex flex-col">
                        <div class="bg-white/95 backdrop-blur-xl h-14 rounded-2xl shadow-[0_8px_30px_rgba(0,0,0,0.12)] border border-white/60 flex items-center px-5 gap-3 relative z-20 transition-all focus-within:ring-4 focus-within:ring-blue-500/20">
                            <button onclick="game.toggleMapMenu()" class="focus:outline-none hover:bg-slate-100 p-2 -ml-2 rounded-xl transition-colors">
                                <i data-lucide="menu" class="text-slate-600 w-5 h-5"></i>
                            </button>
                            <input type="text" id="map-search-input" placeholder="Search locations..." class="flex-1 bg-transparent border-none focus:outline-none text-base text-slate-800 font-medium w-full placeholder-slate-400" oninput="game.handleMapSearch(event)">
                            <div class="bg-blue-50 p-2.5 rounded-xl ml-auto pointer-events-none">
                                <i data-lucide="search" class="text-blue-600 w-4 h-4"></i>
                            </div>
                        </div>
                        
                        <!-- Search Results Dropdown -->
                        <div id="map-search-results" class="bg-white/95 backdrop-blur-xl w-full mt-3 rounded-2xl shadow-[0_10px_40px_rgba(0,0,0,0.1)] overflow-hidden max-h-60 overflow-y-auto hidden absolute top-14 z-10 flex-col border border-slate-100/50"></div>

                        <!-- Map Menu Dropdown -->
                        <div id="map-side-menu" class="bg-white/95 backdrop-blur-xl w-56 mt-3 rounded-2xl shadow-[0_10px_40px_rgba(0,0,0,0.1)] overflow-hidden hidden absolute top-14 left-0 z-10 flex-col border border-slate-100/50 transition-all origin-top-left">
                            <button onclick="game.resetZoom(); game.toggleMapMenu();" class="flex items-center gap-3 px-5 py-4 hover:bg-slate-50 text-left text-sm font-semibold text-slate-700 border-b border-slate-100/50 transition-colors">
                                <div class="p-1.5 bg-blue-50 text-blue-600 rounded-lg"><i data-lucide="compass" class="w-4 h-4"></i></div> Center Map
                            </button>
                            <button onclick="game.toggleMapStyle(); game.toggleMapMenu();" class="flex items-center gap-3 px-5 py-4 hover:bg-slate-50 text-left text-sm font-semibold text-slate-700 border-b border-slate-100/50 transition-colors">
                                <div class="p-1.5 bg-green-50 text-green-600 rounded-lg"><i data-lucide="layers" class="w-4 h-4"></i></div> Toggle Style
                            </button>
                            <button onclick="game.toggleMap(); game.toggleMapMenu();" class="flex items-center gap-3 px-5 py-4 hover:bg-red-50 text-left text-sm font-semibold text-red-600 transition-colors">
                                <div class="p-1.5 bg-red-100 text-red-600 rounded-lg"><i data-lucide="x-circle" class="w-4 h-4"></i></div> Close Map
                            </button>
                        </div>
                    </div>

                    <!-- Map Controls (Functional Zoom & Style Toggle) -->
                    <div class="absolute bottom-8 right-6 flex flex-col gap-3 z-50">
                         <button class="bg-white/90 backdrop-blur-md p-3.5 rounded-2xl shadow-[0_8px_20px_rgba(0,0,0,0.1)] text-slate-600 hover:text-blue-600 hover:bg-white transform active:scale-95 transition-all border border-white/50" onclick="game.toggleMapStyle()" title="Toggle View"><i data-lucide="layers" class="w-6 h-6"></i></button>
                         <button class="bg-white/90 backdrop-blur-md p-3.5 rounded-2xl shadow-[0_8px_20px_rgba(0,0,0,0.1)] text-slate-600 hover:text-blue-600 hover:bg-white transform active:scale-95 transition-all border border-white/50" onclick="game.resetZoom()" title="Reset View"><i data-lucide="compass" class="w-6 h-6"></i></button>
                         <div class="flex flex-col bg-white/90 backdrop-blur-md rounded-2xl shadow-[0_8px_20px_rgba(0,0,0,0.1)] overflow-hidden border border-white/50 mt-2">
                             <button class="p-3.5 text-slate-600 hover:text-blue-600 hover:bg-slate-50 transform active:scale-95 transition-all border-b border-slate-100" onclick="game.zoomMap(1)"><i data-lucide="plus" class="w-6 h-6"></i></button>
                             <button class="p-3.5 text-slate-600 hover:text-blue-600 hover:bg-slate-50 transform active:scale-95 transition-all" onclick="game.zoomMap(-1)"><i data-lucide="minus" class="w-6 h-6"></i></button>
                         </div>
                    </div>

                    <!-- Map Container (Viewport) -->
                    <div id="map-container" class="map-viewport">
                        <!-- MapLibre API Injected Here -->
                    </div>

                    <!-- Close Button -->
                    <button onclick="game.toggleMap()" class="absolute top-6 right-6 bg-white/90 backdrop-blur-md hover:bg-white hover:text-red-500 text-slate-600 p-3.5 rounded-2xl shadow-[0_8px_20px_rgba(0,0,0,0.1)] border border-white/50 z-50 transition-all hover:rotate-90">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>
            </div>

            <!-- Phone Modal Overlay -->
            <div id="phone-modal" class="hidden absolute inset-0 z-[100] bg-black/70 flex items-center justify-center p-4 backdrop-blur-md transition-all duration-300 opacity-0 phone-modal-container">
                <div class="relative group">
                    <!-- Physical Power/Lock Button (Side Button) -->
                    <div class="absolute top-24 -right-2 w-2 h-12 bg-gray-700 rounded-r-lg cursor-pointer hover:bg-gray-600 active:bg-gray-800 transition-colors z-0 shadow-xl" onclick="game.togglePhone()" title="Power/Lock Button (Close Phone)"></div>
                    <!-- Volume Buttons (Visual only) -->
                    <div class="absolute top-24 -left-2 w-1.5 h-8 bg-gray-700 rounded-l-lg z-0"></div>
                    <div class="absolute top-36 -left-2 w-1.5 h-8 bg-gray-700 rounded-l-lg z-0"></div>

                    <div class="relative w-[320px] h-[640px] bg-gray-900 rounded-[3rem] border-8 border-gray-800 shadow-2xl phone-screen overflow-hidden flex flex-col z-10">
                        <!-- Status Bar -->
                        <div class="h-8 bg-black w-full flex justify-between items-center px-6 text-[10px] text-white z-50">
                            <span>09:41</span>
                            <div class="flex gap-1">
                                <i data-lucide="signal" class="w-3 h-3"></i>
                                <i data-lucide="wifi" class="w-3 h-3"></i>
                                <i data-lucide="battery" class="w-3 h-3"></i>
                            </div>
                        </div>
                        
                        <!-- Phone Display Area -->
                        <div id="phone-display" class="flex-1 bg-gray-900 overflow-hidden relative">
                            
                            <!-- Home Screen Wallpaper -->
                            <div id="phone-home" class="w-full h-full absolute inset-0 bg-[url('../images/items/iphonewallpaper.png')] bg-cover bg-center p-6 pt-12">
                                <!-- App Grid -->
                                <div class="grid grid-cols-4 gap-4 content-start">
                                    <!-- Phone -->
                                    <div onclick="game.openApp('phone')" class="flex flex-col items-center gap-1 app-icon cursor-pointer">
                                        <div class="w-12 h-12 bg-green-500 rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="phone" class="text-white w-6 h-6"></i></div>
                                        <span class="text-[10px] text-white font-medium drop-shadow-md">Phone</span>
                                    </div>
                                    <!-- Messages -->
                                    <div onclick="game.openApp('messages')" class="flex flex-col items-center gap-1 app-icon cursor-pointer">
                                        <div class="w-12 h-12 bg-green-400 rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="message-square" class="text-white w-6 h-6"></i></div>
                                        <span class="text-[10px] text-white font-medium drop-shadow-md">Messages</span>
                                    </div>
                                    <!-- Photos -->
                                    <div onclick="game.openApp('photos')" class="flex flex-col items-center gap-1 app-icon cursor-pointer">
                                        <div class="w-12 h-12 bg-white rounded-2xl flex items-center justify-center shadow-lg overflow-hidden relative">
                                            <div class="absolute inset-0 bg-gradient-to-tr from-yellow-400 via-pink-500 to-purple-600 opacity-80"></div>
                                            <i data-lucide="image" class="text-white w-6 h-6 relative z-10"></i>
                                        </div>
                                        <span class="text-[10px] text-white font-medium drop-shadow-md">Photos</span>
                                    </div>
                                    <!-- Camera -->
                                    <div class="flex flex-col items-center gap-1 app-icon cursor-pointer opacity-80">
                                        <div class="w-12 h-12 bg-gray-400 rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="camera" class="text-white w-6 h-6"></i></div>
                                        <span class="text-[10px] text-white font-medium drop-shadow-md">Camera</span>
                                    </div>
                                    <!-- Facebook -->
                                    <div onclick="game.openApp('facebook')" class="flex flex-col items-center gap-1 app-icon cursor-pointer">
                                        <div class="w-12 h-12 bg-blue-600 rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="facebook" class="text-white w-6 h-6"></i></div>
                                        <span class="text-[10px] text-white font-medium drop-shadow-md">Facebook</span>
                                    </div>
                                    <!-- YouTube -->
                                    <div onclick="game.openApp('youtube')" class="flex flex-col items-center gap-1 app-icon cursor-pointer">
                                        <div class="w-12 h-12 bg-red-600 rounded-2xl flex items-center justify-center shadow-lg"><i data-lucide="youtube" class="text-white w-6 h-6"></i></div>
                                        <span class="text-[10px] text-white font-medium drop-shadow-md">YouTube</span>
                                    </div>
                                    <!-- Spotify -->
                                    <div onclick="game.openApp('music')" class="flex flex-col items-center gap-1 app-icon cursor-pointer">
                                        <div class="w-12 h-12 bg-[#1DB954] rounded-2xl flex items-center justify-center shadow-lg">
                                            <svg viewBox="0 0 24 24" class="w-7 h-7 fill-current text-white"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141 4.32-1.38 9.841-.719 13.44 1.5.42.24.6.841.301 1.321zm.12-3.36C15.54 8.46 9.06 8.22 5.34 9.36c-.6.18-1.2-.18-1.38-.72-.18-.6.18-1.2.72-1.38 4.26-1.26 11.4-1.02 15.96 1.68.6.359.84 1.14.479 1.74-.359.6-1.14.84-1.74.48z"/></svg>
                                        </div>
                                        <span class="text-[10px] text-white font-medium drop-shadow-md">Spotify</span>
                                        
                                    </div>
                                    <!-- KBZPay -->
                                    <div onclick="game.openApp('kbzpay')" class="flex flex-col items-center gap-1 app-icon cursor-pointer">
                                        <div class="w-12 h-12 bg-blue-700 rounded-2xl flex items-center justify-center shadow-lg border-2 border-white/20"><span class="text-white font-black text-xs">KBZ</span></div>
                                        <span class="text-[10px] text-white font-medium drop-shadow-md">KBZPay</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Active App Container -->
                            <div id="active-app-container" class="absolute inset-0 bg-white translate-x-full transition-transform duration-300 z-20 flex flex-col">
                                <div id="app-header-bar" class="h-12 bg-gray-100 border-b flex items-center px-4 font-bold text-gray-800 shadow-sm z-30 relative">
                                    <button onclick="game.phoneHome()" class="p-1 -ml-2 rounded-full hover:bg-gray-200 transition-colors"><i data-lucide="chevron-left" class="w-6 h-6 text-blue-500"></i></button>
                                    <span id="app-title-text" class="ml-2 text-sm">App Name</span>
                                </div>
                                <div id="app-content-area" class="flex-1 overflow-y-auto custom-scroll relative bg-white">
                                </div>
                            </div>

                        </div>

                        <!-- Home Indicator Button -->
                        <div class="absolute bottom-2 left-1/2 transform -translate-x-1/2 w-full h-8 z-50 flex items-center justify-center cursor-pointer" onclick="game.phoneHome()">
                            <div class="w-32 h-1 bg-white/50 rounded-full hover:bg-white transition-colors shadow-sm"></div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Settings Modal Overlay -->
            <div id="settings-modal" class="hidden absolute inset-0 z-[110] bg-black/50 flex items-center justify-center p-4 backdrop-blur-sm transition-all duration-300 opacity-0">
                <div class="relative w-full max-w-2xl ios-glass rounded-3xl p-6 md:p-8 flex flex-col gap-6 transition-colors">
                    
                    <!-- Header -->
                    <div class="flex justify-between items-center ios-glass-header pb-4">
                        <h2 id="st-title" class="text-2xl font-cinzel font-bold text-yellow-500 tracking-wider">Settings</h2>
                        <button onclick="game.closeSettings()" class="p-2 ios-close-btn flex items-center justify-center">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <!-- Settings Content List -->
                    <div class="flex flex-col gap-6 overflow-y-auto custom-scroll max-h-[65vh] pr-2">

                        <!-- Game Audio Volume Setting -->
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 ios-setting-row relative z-10 hover:z-[60]">
                            <div class="flex items-center gap-2 relative group cursor-help w-fit">
                                <i data-lucide="volume-2" class="w-5 h-5 opacity-70"></i>
                                <span id="st-ga-vol" class="font-bold text-base md:text-lg tracking-wide opacity-90">Game Audio Vol</span>
                                <i data-lucide="help-circle" class="w-4 h-4 opacity-50"></i>
                                <div class="absolute left-0 top-full mt-2 w-48 p-3 rounded-xl shadow-lg text-xs opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none tooltip-content">
                                    <span id="st-ga-vol-tip">Adjusts the volume of game sound effects.</span>
                                </div>
                            </div>
                            <input type="range" id="ga-vol-slider" min="0" max="1" step="0.1" value="1" oninput="game.setVolume(this.value)" class="w-full md:w-56 ios-slider">
                        </div>

                        <!-- Theme Music Volume Setting -->
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 ios-setting-row relative z-10 hover:z-[60]">
                            <div class="flex items-center gap-2 relative group cursor-help w-fit">
                                <i data-lucide="music" class="w-5 h-5 opacity-70"></i>
                                <span id="st-tm-vol" class="font-bold text-base md:text-lg tracking-wide opacity-90">Theme Music Vol</span>
                                <i data-lucide="help-circle" class="w-4 h-4 opacity-50"></i>
                                <div class="absolute left-0 top-full mt-2 w-48 p-3 rounded-xl shadow-lg text-xs opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none tooltip-content">
                                    <span id="st-tm-vol-tip">Adjusts the volume of the main theme song.</span>
                                </div>
                            </div>
                            <input type="range" id="tm-vol-slider" min="0" max="1" step="0.1" value="0.4" oninput="game.setThemeVolume(this.value)" class="w-full md:w-56 ios-slider">
                        </div>

                        <!-- Game Audio On/Off -->
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 ios-setting-row relative z-10 hover:z-[60]">
                            <div class="flex items-center gap-2 relative group cursor-help w-fit">
                                <i data-lucide="speaker" class="w-5 h-5 opacity-70"></i>
                                <span id="st-ga-state" class="font-bold text-base md:text-lg tracking-wide opacity-90">Game Scene Audio</span>
                                <i data-lucide="help-circle" class="w-4 h-4 opacity-50"></i>
                                <div class="absolute left-0 top-full mt-2 w-48 p-3 rounded-xl shadow-lg text-xs opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none tooltip-content">
                                    <span id="st-ga-state-tip">Toggle the scene specific sound effects.</span>
                                </div>
                            </div>
                            <div class="flex ios-segmented-control w-full md:w-auto">
                                <button onclick="game.setGameAudio('on')" data-val="on" class="flex-1 md:flex-none px-8 py-2 text-sm transition st-btn ios-segment-btn st-btn-ga st-btn-active">
                                    <span id="st-ga-on">On</span>
                                </button>
                                <button onclick="game.setGameAudio('off')" data-val="off" class="flex-1 md:flex-none px-8 py-2 text-sm transition st-btn ios-segment-btn st-btn-ga">
                                    <span id="st-ga-off">Off</span>
                                </button>
                            </div>
                        </div>

                        <!-- Font Size Setting -->
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 ios-setting-row relative z-10 hover:z-[60]">
                            <div class="flex items-center gap-2 relative group cursor-help w-fit">
                                <i data-lucide="type" class="w-5 h-5 opacity-70"></i>
                                <span id="st-font" class="font-bold text-base md:text-lg tracking-wide opacity-90">Font Size</span>
                                <i data-lucide="help-circle" class="w-4 h-4 opacity-50"></i>
                                <div class="absolute left-0 top-full mt-2 w-48 p-3 rounded-xl shadow-lg text-xs opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none tooltip-content">
                                    <span id="st-font-tip">Changes the size of the reading text.</span>
                                </div>
                            </div>
                            <div class="flex ios-segmented-control w-full md:w-auto">
                                <button onclick="game.setFontSize('small')" data-val="small" class="flex-1 md:flex-none px-5 py-2 text-sm transition st-btn ios-segment-btn st-btn-font">
                                    <span id="st-font-sm">Small</span>
                                </button>
                                <button onclick="game.setFontSize('medium')" data-val="medium" class="flex-1 md:flex-none px-5 py-2 text-sm transition st-btn ios-segment-btn st-btn-font st-btn-active">
                                    <span id="st-font-md">Medium</span>
                                </button>
                                <button onclick="game.setFontSize('large')" data-val="large" class="flex-1 md:flex-none px-5 py-2 text-sm transition st-btn ios-segment-btn st-btn-font">
                                    <span id="st-font-lg">Large</span>
                                </button>
                            </div>
                        </div>

                        <!-- Graphics Setting -->
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 ios-setting-row relative z-10 hover:z-[60]">
                            <div class="flex items-center gap-2 relative group cursor-help w-fit">
                                <i data-lucide="monitor" class="w-5 h-5 opacity-70"></i>
                                <span id="st-gfx" class="font-bold text-base md:text-lg tracking-wide opacity-90">Graphics Quality</span>
                                <i data-lucide="help-circle" class="w-4 h-4 opacity-50"></i>
                                <div class="absolute left-0 top-full mt-2 w-48 p-3 rounded-xl shadow-lg text-xs opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none tooltip-content">
                                    <span id="st-gfx-tip">Lowers visual effects for better performance.</span>
                                </div>
                            </div>
                            <div class="flex ios-segmented-control w-full md:w-auto">
                                <button onclick="game.setGraphics('low')" data-val="low" class="flex-1 md:flex-none px-5 py-2 text-sm transition st-btn ios-segment-btn st-btn-gfx">
                                    <span id="st-gfx-low">Low</span>
                                </button>
                                <button onclick="game.setGraphics('medium')" data-val="medium" class="flex-1 md:flex-none px-5 py-2 text-sm transition st-btn ios-segment-btn st-btn-gfx">
                                    <span id="st-gfx-med">Medium</span>
                                </button>
                                <button onclick="game.setGraphics('high')" data-val="high" class="flex-1 md:flex-none px-5 py-2 text-sm transition st-btn ios-segment-btn st-btn-gfx st-btn-active">
                                    <span id="st-gfx-high">High</span>
                                </button>
                            </div>
                        </div>

                        <!-- Language Setting -->
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 ios-setting-row relative z-10 hover:z-[60]">
                            <div class="flex items-center gap-2 relative group cursor-help w-fit">
                                <i data-lucide="globe" class="w-5 h-5 opacity-70"></i>
                                <span id="st-lang" class="font-bold text-base md:text-lg tracking-wide opacity-90">Language</span>
                                <i data-lucide="help-circle" class="w-4 h-4 opacity-50"></i>
                                <div class="absolute left-0 top-full mt-2 w-48 p-3 rounded-xl shadow-lg text-xs opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none tooltip-content">
                                    <span id="st-lang-tip">Switch between English and Burmese.</span>
                                </div>
                            </div>
                            <div class="flex ios-segmented-control w-full md:w-auto">
                                <button onclick="game.setLanguage('en')" data-val="en" class="flex-1 md:flex-none px-8 py-2 text-sm transition st-btn ios-segment-btn st-btn-lang">
                                    English
                                </button>
                                <button onclick="game.setLanguage('mm')" data-val="mm" class="flex-1 md:flex-none px-8 py-2 text-sm transition st-btn ios-segment-btn st-btn-lang st-btn-active">
                                    á€™á€¼á€”á€ºá€™á€¬
                                </button>
                            </div>
                        </div>

                        <!-- Theme Setting -->
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 ios-setting-row relative z-10 hover:z-[60]">
                            <div class="flex items-center gap-2 relative group cursor-help w-fit">
                                <i data-lucide="sun-moon" class="w-5 h-5 opacity-70"></i>
                                <span id="st-theme" class="font-bold text-base md:text-lg tracking-wide opacity-90">Theme</span>
                                <i data-lucide="help-circle" class="w-4 h-4 opacity-50"></i>
                                <div class="absolute left-0 top-full mt-2 w-48 p-3 rounded-xl shadow-lg text-xs opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none tooltip-content">
                                    <span id="st-theme-tip">Toggle between Dark and Light mode.</span>
                                </div>
                            </div>
                            <div class="flex ios-segmented-control w-full md:w-auto">
                                <button onclick="game.setTheme('dark')" data-val="dark" class="flex-1 md:flex-none px-8 py-2 text-sm transition st-btn ios-segment-btn st-btn-theme st-btn-active">
                                    <span id="st-theme-dark">Dark</span>
                                </button>
                                <button onclick="game.setTheme('light')" data-val="light" class="flex-1 md:flex-none px-8 py-2 text-sm transition st-btn ios-segment-btn st-btn-theme">
                                    <span id="st-theme-light">Light</span>
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- UI Layer -->
            <div id="ui-layer"
                class="absolute inset-0 z-50 flex flex-col justify-between p-4 md:p-8 hidden">

                <!-- Top HUD -->
                <div class="flex justify-between items-start w-full">
                    <!-- Left: Location Information -->
                    <div class="flex flex-col gap-3 max-w-[50%]">
                        <div id="location-tag"
                            class="glass-panel text-yellow-400 px-4 py-2 border-l-4 border-yellow-500 font-cinzel tracking-widest text-sm uppercase flex items-center gap-3 rounded-r-lg shadow-lg transform transition hover:translate-x-1">
                            <i data-lucide="map-pin"
                                class="w-4 h-4 flex-shrink-0 animate-pulse"></i>
                            <div class="overflow-hidden">
                                <span id="location-text"
                                    class="block font-bold truncate drop-shadow-md">YANGON</span>
                                <span id="time-text"
                                    class="text-[10px] text-gray-400 font-sans tracking-normal block truncate">DAY
                                    1 - 08:00 AM</span>
                            </div>
                        </div>

                        <div class="flex items-center gap-2">
                            <button onclick="game.audio.toggle()"
                                class="hud-btn w-10 h-10 rounded-full !border-white/20">
                                <i id="audio-icon" data-lucide="volume-2"
                                    class="w-4 h-4 text-yellow-400"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Right: Modern Tool Menu -->
                    <div class="flex flex-col items-end gap-3 pointer-events-auto relative">
                        
                        <!-- Notification Area -->
                        <div id="unlock-notification" class="absolute top-12 right-0 notification-toast bg-white border-l-4 border-green-500 shadow-xl rounded-l-md p-3 flex items-center gap-3 w-64 pointer-events-none z-[60] mb-2">
                            <div class="bg-green-100 p-1.5 rounded-full text-green-600">
                                <i data-lucide="map-pin" class="w-4 h-4"></i>
                            </div>
                            <div>
                                <div class="text-[10px] uppercase text-gray-500 font-bold tracking-wider">New Location</div>
                                <div id="unlock-text" class="text-sm font-bold text-gray-800 leading-tight">Home</div>
                            </div>
                        </div>
                        
                        <!-- Currency Notification -->
                        <div id="currency-notification" class="absolute top-28 right-0 notification-toast bg-gray-900 border-l-4 border-yellow-500 shadow-xl rounded-l-md p-3 flex items-center gap-3 w-64 pointer-events-none z-[60]">
                            <div class="bg-gray-800 p-1.5 rounded-full text-yellow-400">
                                <i data-lucide="coins" class="w-4 h-4"></i>
                            </div>
                            <div>
                                <div class="text-[10px] uppercase text-gray-400 font-bold tracking-wider">Transaction</div>
                                <div id="currency-text" class="text-sm font-bold text-white leading-tight font-mono">0 MMK</div>
                            </div>
                        </div>

                        <!-- Action Bar Container -->
                        <div class="glass-panel p-2 rounded-2xl flex flex-row flex-wrap justify-end gap-2 shadow-2xl border-white/10">
                            
                            <button onclick="game.togglePhone()" class="hud-btn" aria-label="Phone">
                                <i data-lucide="smartphone" class="w-5 h-5"></i>
                                <span class="tooltip">Phone</span>
                            </button>
                            
                            <button onclick="game.toggleMap()" class="hud-btn" aria-label="Map">
                                <i data-lucide="map" class="w-5 h-5"></i>
                                <span class="tooltip">Map</span>
                            </button>
                            
                            <button onclick="game.saveGameManual()" class="hud-btn" aria-label="Save">
                                <i data-lucide="save" class="w-5 h-5"></i>
                                <span class="tooltip">Save</span>
                            </button>
                            
                            <button onclick="game.openSettings()" class="hud-btn" aria-label="Settings">
                                <i data-lucide="settings" class="w-5 h-5"></i>
                                <span class="tooltip" id="hud-st-tip">Settings</span>
                            </button>

                            <div class="w-[1px] h-8 bg-white/10 mx-1 self-center"></div>

                            <button onclick="game.toggleLang()" class="hud-btn w-16" aria-label="Language">
                                <span id="lang-btn" class="font-bold text-[10px]">á€™á€¼á€”á€ºá€™á€¬</span>
                            </button>

                            <button onclick="game.toggleAuto()" id="auto-btn" class="hud-btn" aria-label="Auto Play">
                                <i data-lucide="play-circle" class="w-5 h-5"></i>
                                <span class="tooltip">Auto</span>
                            </button>

                            <div class="w-[1px] h-8 bg-white/10 mx-1 self-center"></div>

                            <button onclick="game.toggleImmersive()" class="hud-btn" aria-label="Immersive Mode">
                                <i data-lucide="eye" class="w-5 h-5"></i>
                                <span class="tooltip">Hide UI</span>
                            </button>
                            
                            <button onclick="game.takeScreenshot()" class="hud-btn" aria-label="Screenshot">
                                <i data-lucide="camera" class="w-5 h-5"></i>
                                <span class="tooltip">Snap</span>
                            </button>
                            
                            <button onclick="game.toggleFullscreen()" id="fs-btn" class="hud-btn" aria-label="Fullscreen">
                                <i data-lucide="maximize" class="w-5 h-5"></i>
                                <span class="tooltip">Full</span>
                            </button>

                            <div class="w-[1px] h-8 bg-white/10 mx-1 self-center"></div>

                            <!-- QUIT BUTTON -->
                            <button onclick="game.quitToMenu()" class="hud-btn" aria-label="Menu">
                                <i data-lucide="home" class="w-5 h-5"></i>
                                <span class="tooltip" id="hud-quit-tip">Menu</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Interaction Area -->
                <div
                    class="mt-auto w-full max-w-5xl mx-auto space-y-3 md:space-y-4">
                    <div id="choices-container"
                        class="flex flex-col gap-2 items-center mb-2 transition-all duration-500 min-h-[40px] max-h-[35vh] overflow-y-auto pr-1 custom-scroll pointer-events-auto">
                    </div>
                    <div id="dialogue-box"
                        class="dialogue-box p-6 md:p-8 relative min-h-[160px] md:min-h-[200px] cursor-pointer group transition-all duration-300 hover:border-yellow-500/30 pointer-events-auto"
                        onclick="game.next()">
                        <div
                            class="absolute -top-3 md:-top-4 left-6 md:left-10 z-10">
                            <div id="speaker-box"
                                class="bg-gray-900 px-6 py-1.5 text-xs md:text-sm font-bold tracking-[0.2em] text-yellow-500 uppercase transform skew-x-[-12deg] shadow-[0_5px_20px_rgba(0,0,0,0.5)] border border-yellow-500/50 hidden transition-colors">
                                <span id="speaker-name"
                                    class="transform skew-x-[12deg] inline-block font-noto">NAME</span>
                            </div>
                        </div>
                        <p id="dialogue-text"
                            class="text-lg md:text-xl leading-relaxed md:leading-9 text-gray-200 font-medium tracking-wide font-noto cursor relative z-0 mt-2 md:mt-0 drop-shadow-md transition-all">
                        </p>
                        <div
                            class="absolute bottom-4 right-6 text-yellow-500 opacity-0 transition-opacity duration-300"
                            id="next-indicator">
                            <div
                                class="animate-bounce flex flex-col items-center">
                                <i data-lucide="chevron-down"
                                    class="w-6 h-6"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Start Screen (Main Menu) -->
            <div id="start-screen" class="absolute inset-0 z-[80] flex bg-black overflow-hidden transition-colors">
                
                <!-- Background Video -->
                <video id="main-menu-video" loop muted playsinline class="absolute inset-0 w-full h-full object-cover opacity-100 z-0 ">
                    <source src="https://www.pexels.com/download/video/6205145/" type="video/mp4">
                </video>
                
                <!-- Film Grain / Atmosphere Layer -->
                <div class="menu-grain z-10 transition-opacity"></div>
                <!-- Dark Gradient Overlay -->
                <div class="absolute inset-0 bg-gradient-to-r from-black/95 via-black/80 to-black/30 z-10 transition-colors"></div>
                
                <!-- Main Layout Container -->
                <div class="relative z-20 w-full h-full flex flex-col md:flex-row p-8 md:p-16 lg:p-24 items-center md:items-stretch">
                    
                    <!-- Left Column: Title & Mood -->
                    <div class="flex-1 flex flex-col justify-center items-start space-y-8 max-w-3xl">
                        
                        <div class="animate-slide-up" style="animation-delay: 0.1s;">
                            <div class="inline-flex items-center gap-2 border border-white/20 px-6 py-2 rounded-full bg-black/40 backdrop-blur-md shadow-lg">
                                <div class="w-2 h-2 rounded-full bg-yellow-500 animate-pulse"></div>
                                <div class="text-gray-300 tracking-[0.3em] text-[10px] md:text-xs uppercase font-semibold">
                                    Enterprise Edition
                                </div>
                            </div>
                        </div>

                        <div class="animate-slide-up" style="animation-delay: 0.2s;">
                            <h1 class="text-6xl md:text-8xl lg:text-[9rem] font-black text-transparent bg-clip-text bg-gradient-to-b from-white via-gray-200 to-gray-500 title-font drop-shadow-2xl leading-[0.9] tracking-tighter">
                                THE<br>
                                <span class="text-transparent bg-clip-text bg-gradient-to-r from-gray-100 to-gray-400 transition-colors">BETWEENS</span>
                            </h1>
                        </div>

                        <div class="animate-slide-up space-y-4 border-l-2 border-white/30 pl-6" style="animation-delay: 0.3s;">
                            <p class="text-gray-300 text-lg md:text-2xl font-light tracking-wide opacity-90 max-w-xl transition-colors">
                                Two worlds. One reality.
                            </p>
                            <p class="text-gray-500 text-sm md:text-base max-w-xl leading-relaxed font-sans opacity-80 transition-colors">
                                Navigate the fractured timelines of Yangon. Uncover the truth hidden in the echoes of the city. Your choices define the reality you wake up in.
                            </p>
                        </div>
                    </div>

                    <!-- Right Column: Interactive Menu -->
                    <div class="w-full md:w-[400px] flex flex-col justify-center items-start pl-0 md:pl-16 mt-12 md:mt-0 relative animate-slide-up" style="animation-delay: 0.5s;">
                         
                         <!-- Divider Line (Mobile/Desktop adaptive) -->
                         <div class="absolute left-0 top-1/2 -translate-y-1/2 w-[1px] h-[60%] bg-gradient-to-b from-transparent via-white/20 to-transparent hidden md:block"></div>

                         <div class="flex flex-col w-full space-y-2">
                            <button onclick="game.init()" class="menu-item primary">
                                <div class="icon-box"><i data-lucide="play" class="w-6 h-6 fill-current"></i></div>
                                <span id="st-menu-new">NEW GAME</span>
                            </button>
                            
                            <button onclick="game.loadGame()" id="load-btn" class="menu-item hidden">
                                <div class="icon-box"><i data-lucide="rotate-ccw" class="w-5 h-5"></i></div>
                                <span id="st-menu-load">RESUME JOURNEY</span>
                            </button>
                            
                            <button onclick="alert('Feature coming in next update')" class="menu-item">
                                <div class="icon-box"><i data-lucide="image" class="w-5 h-5"></i></div>
                                <span id="st-menu-gallery">SCENE GALLERY</span>
                            </button>
                            
                            <button onclick="game.openSettings()" class="menu-item">
                                <div class="icon-box"><i data-lucide="settings" class="w-5 h-5"></i></div>
                                <span id="st-menu-set">SETTINGS</span>
                            </button>
                            
                            <button onclick="alert('Standard Terms & Conditions Apply')" class="menu-item">
                                <div class="icon-box"><i data-lucide="file-text" class="w-5 h-5"></i></div>
                                <span id="st-menu-terms">TERMS AND CONDITIONS</span>
                            </button>
                            
                            <button onclick="alert('Created by Gemini & User')" class="menu-item">
                                <div class="icon-box"><i data-lucide="users" class="w-5 h-5"></i></div>
                                <span id="st-menu-credits">CREDITS</span>
                            </button>
                            
                            <button onclick="location.reload()" class="menu-item" style="color: #ef4444; border-bottom-color: rgba(239, 68, 68, 0.2);">
                                <div class="icon-box" style="color: #ef4444;"><i data-lucide="power" class="w-5 h-5"></i></div>
                                <span id="st-menu-quit">QUIT</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
    // --- DICTIONARY FOR SETTINGS ---
    const SETTINGS_DICT = {
        title: { en: "Settings", mm: "á€†á€€á€ºá€á€„á€ºá€™á€»á€¬á€¸" },
        ga_vol: { en: "Game Audio Vol", mm: "á€‚á€­á€™á€ºá€¸á€¡á€žá€¶á€¡á€á€­á€¯á€¸á€¡á€€á€»á€šá€º" },
        ga_vol_tip: { en: "Adjusts the volume of game sound effects.", mm: "á€‚á€­á€™á€ºá€¸á€¡á€á€½á€„á€ºá€¸á€¡á€žá€¶á€™á€»á€¬á€¸á á€¡á€á€­á€¯á€¸á€¡á€€á€»á€šá€ºá€€á€­á€¯ á€á€»á€­á€”á€ºá€Šá€¾á€­á€›á€”á€ºá‹" },
        tm_vol: { en: "Theme Music Vol", mm: "á€”á€±á€¬á€€á€ºá€á€¶á€á€±á€¸á€‚á€®á€ á€¡á€á€­á€¯á€¸á€¡á€€á€»á€šá€º" },
        tm_vol_tip: { en: "Adjusts the volume of the main theme song.", mm: "á€•á€„á€ºá€™á€”á€±á€¬á€€á€ºá€á€¶á€á€±á€¸á€‚á€®á€á á€¡á€á€­á€¯á€¸á€¡á€€á€»á€šá€ºá€€á€­á€¯ á€á€»á€­á€”á€ºá€Šá€¾á€­á€›á€”á€ºá‹" },
        ga_state: { en: "Game Scene Audio", mm: "á€‚á€­á€™á€ºá€¸á€”á€±á€¬á€€á€ºá€á€¶á€¡á€žá€¶" },
        ga_state_tip: { en: "Toggle the scene specific sound effects.", mm: "á€‚á€­á€™á€ºá€¸á€¡á€á€½á€„á€ºá€¸á€”á€±á€¬á€€á€ºá€á€¶á€¡á€žá€¶á€™á€»á€¬á€¸á€€á€­á€¯ á€–á€½á€„á€·á€ºá€›á€”á€º á€žá€­á€¯á€·á€™á€Ÿá€¯á€á€º á€•á€­á€á€ºá€›á€”á€ºá‹" },
        ga_on: { en: "On", mm: "á€–á€½á€„á€·á€º" },
        ga_off: { en: "Off", mm: "á€•á€­á€á€º" },
        font_size: { en: "Font Size", mm: "á€…á€¬á€œá€¯á€¶á€¸á€¡á€›á€½á€šá€ºá€¡á€…á€¬á€¸" },
        font_tip: { en: "Changes the size of the reading text.", mm: "á€…á€¬á€–á€á€ºá€›á€™á€Šá€·á€º á€…á€¬á€œá€¯á€¶á€¸á€™á€»á€¬á€¸á á€¡á€›á€½á€šá€ºá€¡á€…á€¬á€¸á€€á€­á€¯ á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€›á€”á€ºá‹" },
        font_sm: { en: "Small", mm: "á€¡á€žá€±á€¸á€…á€¬á€¸" },
        font_md: { en: "Medium", mm: "á€¡á€œá€á€ºá€…á€¬á€¸" },
        font_lg: { en: "Large", mm: "á€¡á€€á€¼á€®á€¸á€…á€¬á€¸" },
        graphics: { en: "Graphics Quality", mm: "á€›á€¯á€•á€ºá€‘á€½á€€á€ºá€¡á€›á€Šá€ºá€¡á€žá€½á€±á€¸" },
        gfx_tip: { en: "Lowers visual effects for better performance.", mm: "á€…á€€á€ºá€¡á€œá€±á€¸á€™á€á€¶á€›á€…á€±á€›á€”á€º á€›á€¯á€•á€ºá€‘á€½á€€á€ºá€¡á€‘á€°á€¸á€•á€¼á€¯á€œá€¯á€•á€ºá€á€»á€€á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€œá€»á€¾á€±á€¬á€·á€á€»á€›á€”á€ºá‹" },
        gfx_low: { en: "Low", mm: "á€¡á€”á€­á€™á€·á€º" },
        gfx_med: { en: "Medium", mm: "á€¡á€œá€á€º" },
        gfx_high: { en: "High", mm: "á€¡á€™á€¼á€„á€·á€º" },
        language: { en: "Language", mm: "á€˜á€¬á€žá€¬á€…á€€á€¬á€¸" },
        lang_tip: { en: "Switch between English and Burmese.", mm: "á€¡á€„á€ºá€¹á€‚á€œá€­á€•á€ºá€”á€¾á€„á€·á€º á€™á€¼á€”á€ºá€™á€¬á€˜á€¬á€žá€¬á€…á€€á€¬á€¸ á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€›á€”á€ºá‹" },
        theme: { en: "Theme", mm: "á€¡á€žá€½á€„á€ºá€¡á€•á€¼á€„á€º" },
        theme_tip: { en: "Toggle between Dark and Light mode.", mm: "á€¡á€œá€„á€ºá€¸á€”á€¾á€„á€·á€º á€¡á€™á€¾á€±á€¬á€„á€ºá€•á€¯á€¶á€…á€¶ á€•á€¼á€±á€¬á€„á€ºá€¸á€œá€²á€›á€”á€ºá‹" },
        theme_dark: { en: "Dark", mm: "á€¡á€™á€¾á€±á€¬á€„á€º" },
        theme_light: { en: "Light", mm: "á€¡á€œá€„á€ºá€¸" },
        menu_new: { en: "NEW GAME", mm: "á€‚á€­á€™á€ºá€¸á€¡á€žá€…á€ºá€…á€›á€”á€º" },
        menu_load: { en: "RESUME JOURNEY", mm: "á€†á€€á€ºá€œá€€á€ºá€€á€…á€¬á€¸á€›á€”á€º" },
        menu_gallery: { en: "SCENE GALLERY", mm: "á€“á€¬á€á€ºá€•á€¯á€¶á€•á€¼á€á€”á€ºá€¸" },
        menu_set: { en: "SETTINGS", mm: "á€†á€€á€ºá€á€„á€ºá€™á€»á€¬á€¸" },
        menu_terms: { en: "TERMS & CONDITIONS", mm: "á€…á€Šá€ºá€¸á€™á€»á€¥á€ºá€¸á€”á€¾á€„á€ºá€· á€žá€á€ºá€™á€¾á€á€ºá€á€»á€€á€ºá€™á€»á€¬á€¸"},
        menu_credits: { en: "CREDITS", mm: "á€á€›á€€á€ºá€’á€…á€º"},
        menu_quit: { en: "QUIT", mm: "á€‘á€½á€€á€ºá€™á€Šá€º" },
        hud_quit: { en: "Menu", mm: "á€¡á€…á€žá€­á€¯á€·" }
    };

    // --- LOCATION DATABASE ---
    const LOCATIONS = [
        { id: 'imc', type: 'school', lat: 16.823366, lng: 96.130645, name: { en: "Info Myanmar College", mm: "Info Myanmar College" }, scene: 'school_imc' },
        { id: 'naung_gyi', type: 'home', lat: 16.849836, lng: 96.157178, name: { en: "Naung Gyi's House", mm: "á€”á€±á€¬á€„á€ºá€€á€¼á€®á€¸ á€¡á€­á€™á€º" }, scene: 'home_naunggyi' },
        { id: 'home', type: 'home', lat: 16.880386, lng: 96.156378, name: { en: "Tayza's House", mm: "á€á€±á€‡ á€¡á€­á€™á€º" }, scene: 'intro-tayza' },
        { id: 'shwedagon', type: 'shwedagon_pagoda', lat: 16.7984, lng: 96.1496, name: { en: "Shwedagon Pagoda", mm: "á€›á€½á€¾á€±á€á€­á€‚á€¯á€¶á€˜á€¯á€›á€¬á€¸" }, scene: 'shwedagon_arrival' },
        { id: 'kantawgyi', type: 'park', lat: 16.795, lng: 96.166, name: { en: "Kandawgyi Lake", mm: "á€€á€”á€ºá€á€±á€¬á€ºá€€á€¼á€®á€¸" }, scene: 'place_kantawgyi' },
        { id: 'inyalake', type: 'park', lat: 16.837, lng: 96.143, name: { en: "Inya Lake", mm: "á€¡á€„á€ºá€¸á€šá€¬á€¸á€€á€”á€º" }, scene: 'place_inya' },
        { id: 'mmplaza', type: 'mmplaza', lat: 16.827439, lng: 96.154957, name: { en: "Myanmar Plaza", mm: "á€™á€¼á€”á€ºá€™á€¬á€•á€œá€¬á€‡á€¬" }, scene: 'place_mmplaza' },
        { id: 'junction_city', type: 'mall', lat: 16.7792557, lng: 96.1544072, name: { en: "Junction City", mm: "Junction City" }, scene: 'mall_jc' },
        { id: 'hmone_gyi', type: 'tea_shop', lat: 16.785, lng: 96.145, name: { en: "Hmone Gyi Tea Shop", mm: "á€™á€¾á€¯á€”á€ºá€€á€¼á€®á€¸á€œá€€á€ºá€–á€€á€ºá€›á€Šá€ºá€†á€­á€¯á€„á€º" }, scene: 'tea_hmonegyi' },
        { id: 'sule', type: 'sule_pagoda', lat: 16.7744, lng: 96.1586, name: { en: "Sule Pagoda", mm: "á€†á€°á€¸á€œá€±á€˜á€¯á€›á€¬á€¸" }, scene: 'place_sule' },
        { id: 'downtown', type: 'city', lat: 16.775327, lng: 96.151123, name: { en: "Downtown", mm: "á€™á€¼á€­á€¯á€·á€œá€šá€ºá€á€±á€«á€„á€º" }, scene: 'place_downtown' },
        { id: 'alwan_cafe', type: 'cafe_shop', lat: 16.780, lng: 96.150, name: { en: "A Lwan CafÃ©", mm: "á€¡á€œá€½á€™á€ºá€¸á€€á€–á€±á€¸" }, scene: 'cafe_alwan' },
    ];
    
    // --- ASSETS DATABASE ---
    const ASSETS = {
        bg: {
            downtown: "../images/places/downtown.png",
            sule: "../images/places/sule.png",
            shwedagon: "../images/places/shwedagon.png",
            shwedagon_stairs: "../images/places/shwedagon_stairs.png",
            shwedagon_night: "../images/places/shwedagon_night.png",
            kantawgyi: "../images/places/kantawg.png",
            home_tayza: "../images/places/home_tayza.png",
            alarm: "../images/items/alarm.png",
            sleep_tayza: "../images/person/sleep-tayza.png",
            wakeup_tayza: "../images/person/wakeup-tayza.png",
            oldfan: "../images/items/oldfan.png",
            missedcall: "../images/items/missedcall.png",
            stair: "../images/places/stair.png",
            kitchen: "../images/places/kitchen.png",
            livingroom: "../images/places/livingroom.png",
            bathroom: "../images/places/bathroom.png",
            dining_room: "../images/places/dining_room.png",
            bedroom_night: "../images/places/bedroom_night.png",
            parallel_sule: "../images/places/parallel_sule.png",
            parallel_street: "../images/places/parallel_street.png",
            ring_item: "../images/items/ring.png",
            faceless_mom: "../images/person/faceless_mom.png"
        },
        audio: {
            main_theme: "../audios/main_theme.mp3",
            morning_chant: "../audios/morning_bird.mp3",
            alarm: "../audios/alarm.mp3",
            yawn: "../audios/yawn.mp3",
            oldfan: "../audios/oldfan.mp3",
            stair: "../audios/footstep.mp3",
            kitchen: "../audios/kitchen.mp3",
            water_splash: "../audios/water_splash.mp3",
            pagoda_bells: "../audios/pagoda_bells.mp3",
            city_ambience: "../audios/city_ambience.mp3",
            creepy_drone: "../audios/creepy_drone.mp3"
        },
        icons: {
            home: "../images/places/home.gif",
            shwedagon_pagoda: "../images/places/pagoda.gif",
            sule_pagoda: "../images/places/pagoda.gif",
            tea_shop: "../images/places/cafe-tea.gif",
            cafe_shop: "../images/places/cafe-tea.gif",
            school: "../images/places/school.gif",
            mall: "../images/places/mall.gif",
            park: "../images/places/lake.gif",
            city: "../images/places/city.gif",
            player: "../images/places/current.gif", 
            tree: "../images/places/tree.gif",
            inyalake: "../images/places/lake.gif",
            mmplaza: "../images/places/mall.gif",
        }
    };

    // --- GAME ENGINE ---
    class GameEngine {
        constructor() {
            this.state = {
                stats: { sanity: 100, trust: 0, life: 50, knowledge: 0 },
                flags: {},
                currency: 0, 
                day: 1,
                sceneId: 'start',
                lang: 'mm',
                settings: { volume: 1.0, themeVolume: 0.4, gameAudio: 'on', fontSize: 'medium', graphics: 'high', theme: 'dark' }
            };
            this.typingSpeed = 20;
            this.isTyping = false;
            this.typingTimer = null; 
            this.autoPlayTimer = null; 
            this.autoPlay = false; 
            this.sceneData = null;
            this.dialogueIndex = 0;
            this.audio = new AudioController();
            this.activeLayer = 1; 
            this.currentBgKey = null; 
            this.immersiveMode = false;
            this.mapOpen = false;
            this.phoneOpen = false;
            this.settingsOpen = false;
            this.phoneApp = null;
            
            // MapLibre properties
            this.map = null;
            this.markers = [];
            this.currentMapStyle = 'normal';
            this.mapStyles = {
                normal: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
                satellite: {
                    "version": 8,
                    "sources": {
                        "esri-satellite": {
                            "type": "raster",
                            "tiles": ["https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}"],
                            "tileSize": 256,
                            "attribution": "Tiles &copy; Esri"
                        }
                    },
                    "layers": [{
                        "id": "satellite",
                        "type": "raster",
                        "source": "esri-satellite",
                        "minzoom": 0,
                        "maxzoom": 19
                    }]
                }
            };

            if(localStorage.getItem('ringGameSave_V5')) {
                const btn = document.getElementById('load-btn');
                btn.classList.remove('hidden');
                btn.classList.add('flex');
            }
            
            const saveStr = localStorage.getItem('ringGameSave_V5');
            if(saveStr) {
                const parsed = JSON.parse(saveStr);
                if(parsed.settings) this.state.settings = parsed.settings;
            }
            if (this.state.settings.themeVolume === undefined) this.state.settings.themeVolume = 0.4;
            if (this.state.settings.gameAudio === undefined) this.state.settings.gameAudio = 'on';
            
            this.applySettings();
            this.renderSettingsText();
            this.initPreloader();
        }

        initPreloader() {
            const allAssets = [];
            if (ASSETS.bg) Object.values(ASSETS.bg).forEach(url => allAssets.push({type: 'image', url}));
            if (ASSETS.icons) Object.values(ASSETS.icons).forEach(url => allAssets.push({type: 'image', url}));
            if (ASSETS.audio) Object.values(ASSETS.audio).forEach(url => allAssets.push({type: 'audio', url}));
            allAssets.push({type: 'video', url: '../videos/herovideo.mp4'});

            let loadedCount = 0;
            const totalAssets = allAssets.length;
            const barFill = document.getElementById('loading-bar-fill');
            const loadText = document.getElementById('loading-text');
            const startBtn = document.getElementById('start-btn');
            const loadSpinner = document.getElementById('loading-spinner');

            const playPreloaderAudio = () => {
                if (this.audio && this.audio.themeMusic && this.audio.themeMusic.paused) {
                    this.audio.themeMusic.volume = this.state.settings.themeVolume !== undefined ? this.state.settings.themeVolume : 0.4;
                    this.audio.themeMusic.play().catch(e => console.log("Autoplay blocked."));
                }
            };
            playPreloaderAudio();
            document.addEventListener('click', playPreloaderAudio, { once: true });

            const updateProgress = () => {
                loadedCount++;
                let percent = Math.floor((loadedCount / totalAssets) * 100);
                if(barFill) barFill.style.width = percent + '%';
                if(loadText) loadText.innerText = `Loading Assets... ${percent}%`;
                if (loadedCount >= totalAssets && loadText && loadText.innerText !== "Ready to go") {
                    if(loadText) loadText.innerText = "Ready to go";
                    if(startBtn) startBtn.classList.remove('hidden');
                    if(loadSpinner) loadSpinner.classList.add('hidden');
                    if(barFill) barFill.classList.add('animate-pulse');
                }
            };

            if (totalAssets === 0) { updateProgress(); return; }

            allAssets.forEach(asset => {
                if (asset.type === 'image') { const img = new Image(); img.onload = updateProgress; img.onerror = updateProgress; img.src = asset.url; }
                else if (asset.type === 'audio') { const aud = new Audio(); aud.addEventListener('canplaythrough', updateProgress, { once: true }); aud.addEventListener('error', updateProgress, { once: true }); aud.src = asset.url; aud.load(); }
                else if (asset.type === 'video') { const vid = document.createElement('video'); vid.addEventListener('canplaythrough', updateProgress, { once: true }); vid.addEventListener('error', updateProgress, { once: true }); vid.src = asset.url; vid.load(); }
            });

            setTimeout(() => {
                if (loadedCount < totalAssets) { loadedCount = totalAssets - 1; updateProgress(); }
            }, 12000); 
        }

        startFromPreloader() {
            const preloader = document.getElementById('preloader-screen');
            if (preloader) {
                preloader.classList.add('opacity-0');
                const bgVideo = document.getElementById('main-menu-video');
                if(bgVideo) bgVideo.play().catch(e => console.log(e));
                setTimeout(() => { preloader.classList.add('hidden'); }, 1000);
            }
        }

        init() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('ui-layer').classList.remove('hidden');
            document.getElementById('ui-layer').classList.add('flex');
            lucide.createIcons();
            this.loadScene('yangon_intro');
            this.setupMapInteractions();
            this.updateCurrency(0);
        }

        quitToMenu() {
            document.getElementById('ui-layer').classList.add('hidden');
            document.getElementById('ui-layer').classList.remove('flex');
            const startScreen = document.getElementById('start-screen');
            startScreen.classList.remove('hidden');
            startScreen.classList.remove('opacity-0');
            const loadBtn = document.getElementById('load-btn');
            loadBtn.classList.remove('hidden');
            loadBtn.classList.add('flex');
            
            this.isTyping = false;
            if(this.typingTimer) clearTimeout(this.typingTimer);
            if(this.autoPlayTimer) clearTimeout(this.autoPlayTimer);
            if (this.audio && this.audio.bgMusic) this.audio.bgMusic.pause();
            this.saveGameManual();
        }
        
        setupMapInteractions() {
            // Replaced by native MapLibre interactions
        }

        startDrag(e) { }
        drag(e) { }
        endDrag() { }

        toggleMap() {
            const modal = document.getElementById('map-modal');
            if (this.mapOpen) {
                modal.classList.add('opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            } else {
                modal.classList.remove('hidden');
                void modal.offsetWidth; 
                modal.classList.remove('opacity-0');
                
                this.renderMap();
                
                // IMPORTANT FIX FOR MAPLIBRE: Map container size is 0 when hidden, need to resize after showing
                setTimeout(() => {
                    if (this.map) {
                        this.map.resize();
                    }
                }, 50);
                setTimeout(() => {
                    if (this.map) {
                        this.map.resize();
                    }
                }, 350); // After modal transition completes
            }
            this.mapOpen = !this.mapOpen;
        }

        toggleMapMenu() {
            const menu = document.getElementById('map-side-menu');
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                menu.classList.add('flex');
                document.getElementById('map-search-results').classList.add('hidden');
            } else {
                menu.classList.add('hidden');
                menu.classList.remove('flex');
            }
        }

        handleMapSearch(e) {
            const query = e.target.value.toLowerCase();
            const resultsContainer = document.getElementById('map-search-results');
            document.getElementById('map-side-menu').classList.add('hidden'); 
            
            if (!query) {
                resultsContainer.classList.add('hidden');
                resultsContainer.classList.remove('flex');
                return;
            }
            
            const matches = LOCATIONS.filter(loc => {
                const nameEn = (loc.name.en || '').toLowerCase();
                const nameMm = (loc.name.mm || '').toLowerCase();
                return nameEn.includes(query) || nameMm.includes(query);
            });
            
            if (matches.length > 0) {
                resultsContainer.innerHTML = '';
                matches.forEach(loc => {
                    const btn = document.createElement('button');
                    btn.className = "flex items-center gap-4 px-5 py-4 hover:bg-blue-50/50 text-left w-full border-b border-slate-50 transition-colors group";
                    const iconUrl = ASSETS.icons[loc.type] || ASSETS.icons.city;
                    const dispName = loc.name[this.state.lang] || loc.name.en;
                    btn.innerHTML = `
                        <div class="bg-slate-100 p-2 rounded-xl group-hover:bg-white group-hover:shadow-sm transition-all text-slate-500 group-hover:text-blue-500">
                            <img src="${iconUrl}" class="w-5 h-5 object-contain">
                        </div>
                        <span class="text-sm font-semibold text-slate-700 group-hover:text-blue-600 transition-colors">${dispName}</span>
                    `;
                    btn.onclick = () => {
                        if(this.map) this.map.flyTo({ center: [loc.lng, loc.lat], zoom: 16 });
                        resultsContainer.classList.add('hidden');
                        resultsContainer.classList.remove('flex');
                        document.getElementById('map-search-input').value = dispName;
                    };
                    resultsContainer.appendChild(btn);
                });
                resultsContainer.classList.remove('hidden');
                resultsContainer.classList.add('flex');
            } else {
                resultsContainer.innerHTML = '<div class="p-4 text-sm text-slate-500 text-center font-medium">No locations found.</div>';
                resultsContainer.classList.remove('hidden');
                resultsContainer.classList.add('flex');
            }
        }

        toggleMapStyle() {
            if (!this.map) return;
            this.currentMapStyle = this.currentMapStyle === 'normal' ? 'satellite' : 'normal';
            this.map.setStyle(this.mapStyles[this.currentMapStyle]);
        }

        togglePhone() {
            const modal = document.getElementById('phone-modal');
            if (this.phoneOpen) {
                modal.classList.add('opacity-0');
                setTimeout(() => { modal.classList.add('hidden'); this.phoneHome(); }, 300);
            } else {
                modal.classList.remove('hidden');
                void modal.offsetWidth; 
                modal.classList.remove('opacity-0');
            }
            this.phoneOpen = !this.phoneOpen;
        }

        phoneHome() {
            const activeApp = document.getElementById('active-app-container');
            activeApp.classList.remove('app-screen-active');
            activeApp.classList.add('translate-x-full');
            this.phoneApp = null;
        }

        toggleMusic() {
            const audio = document.getElementById('music-player-audio');
            const icon = document.getElementById('music-play-icon');
            if (!audio) return;
            if (audio.paused) { audio.play(); icon.parentElement.innerHTML = '<i id="music-play-icon" data-lucide="pause" class="w-6 h-6 fill-current ml-1"></i>'; lucide.createIcons(); } 
            else { audio.pause(); icon.parentElement.innerHTML = '<i id="music-play-icon" data-lucide="play" class="w-6 h-6 fill-current ml-1"></i>'; lucide.createIcons(); }
        }

        updateMusicProgress() {
            const audio = document.getElementById('music-player-audio');
            const progress = document.getElementById('music-progress');
            const thumb = document.getElementById('music-thumb');
            const current = document.getElementById('music-current-time');
            if (audio && progress) {
                const percent = (audio.currentTime / audio.duration) * 100;
                progress.style.width = `${percent}%`;
                if(thumb) thumb.style.left = `${percent}%`;
                const mins = Math.floor(audio.currentTime / 60); const secs = Math.floor(audio.currentTime % 60);
                current.innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }
        }

        initMusicDuration() {
            const audio = document.getElementById('music-player-audio');
            const total = document.getElementById('music-duration');
            if (audio && total) {
                const mins = Math.floor(audio.duration / 60); const secs = Math.floor(audio.duration % 60);
                total.innerText = `${mins}:${secs < 10 ? '0' : ''}${secs}`;
            }
        }

        openApp(appName) {
            this.phoneApp = appName;
            const activeApp = document.getElementById('active-app-container');
            const contentArea = document.getElementById('app-content-area');
            const title = document.getElementById('app-title-text');
            const header = document.getElementById('app-header-bar');

            header.style.display = 'flex';
            header.className = "h-12 border-b flex items-center px-4 font-bold shadow-sm z-30 relative transition-colors bg-white text-gray-800";
            let html = '';
            
            if (appName === 'phone') {
                title.innerText = "Phone";
                html = `
                    <div class="h-full flex flex-col">
                        <div class="flex-1 flex flex-col items-center justify-center p-6">
                             <div class="text-4xl text-gray-800 font-light mb-8"></div>
                             <div class="grid grid-cols-3 gap-6 text-2xl font-medium text-gray-800">
                                 <button class="w-16 h-16 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center">1</button>
                                 <button class="w-16 h-16 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center">2</button>
                                 <button class="w-16 h-16 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center">3</button>
                                 <button class="w-16 h-16 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center">4</button>
                                 <button class="w-16 h-16 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center">5</button>
                                 <button class="w-16 h-16 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center">6</button>
                                 <button class="w-16 h-16 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center">7</button>
                                 <button class="w-16 h-16 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center">8</button>
                                 <button class="w-16 h-16 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center">9</button>
                                 <button class="w-16 h-16 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-3xl">*</button>
                                 <button class="w-16 h-16 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center">0</button>
                                 <button class="w-16 h-16 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-xl">#</button>
                             </div>
                             <div class="mt-8">
                                 <button class="w-20 h-20 bg-green-500 rounded-full flex items-center justify-center shadow-lg text-white"><i data-lucide="phone" class="w-8 h-8"></i></button>
                             </div>
                        </div>
                        <div class="h-16 border-t flex items-center justify-around text-xs text-gray-500 font-medium bg-gray-50">
                             <div class="flex flex-col items-center text-blue-500"><i data-lucide="grid" class="w-5 h-5 mb-1"></i>Keypad</div>
                             <div class="flex flex-col items-center"><i data-lucide="clock" class="w-5 h-5 mb-1"></i>Recents</div>
                             <div class="flex flex-col items-center"><i data-lucide="users" class="w-5 h-5 mb-1"></i>Contacts</div>
                        </div>
                    </div>
                `;
            } else if (appName === 'messages') {
                title.innerText = "Messages";
                html = `
                    <div class="p-4 space-y-4">
                        <div class="flex gap-3 items-center border-b border-gray-100 pb-3">
                            <div class="w-10 h-10 bg-orange-200 rounded-full flex items-center justify-center text-orange-600 font-bold">M</div>
                            <div class="flex-1">
                                <div class="flex justify-between items-baseline"><span class="font-bold text-gray-800">Mom</span> <span class="text-xs text-gray-400">14m ago</span></div>
                                <div class="text-sm text-gray-500 truncate">Please come home early today...</div>
                            </div>
                        </div>
                        <div class="flex gap-3 items-center border-b border-gray-100 pb-3">
                            <div class="w-10 h-10 bg-purple-200 rounded-full flex items-center justify-center text-purple-600 font-bold">N</div>
                            <div class="flex-1">
                                <div class="flex justify-between items-baseline"><span class="font-bold text-gray-800">Nay Chi</span> <span class="text-xs text-gray-400">Yesterday</span></div>
                                <div class="text-sm text-gray-500 truncate">Are you free this weekend?</div>
                            </div>
                        </div>
                        <div class="flex gap-3 items-center border-b border-gray-100 pb-3">
                            <div class="w-10 h-10 bg-blue-200 rounded-full flex items-center justify-center text-blue-600 font-bold">K</div>
                            <div class="flex-1">
                                <div class="flex justify-between items-baseline"><span class="font-bold text-gray-800">Kyaw Gyi</span> <span class="text-xs text-gray-400">2d ago</span></div>
                                <div class="text-sm text-gray-500 truncate">Bro, check the group chat.</div>
                            </div>
                        </div>
                        <div class="flex gap-3 items-center opacity-60">
                            <div class="w-10 h-10 bg-gray-200 rounded-full flex items-center justify-center text-gray-600 font-bold">O</div>
                            <div class="flex-1">
                                <div class="flex justify-between items-baseline"><span class="font-bold text-gray-800">Ooredoo</span> <span class="text-xs text-gray-400">1w ago</span></div>
                                <div class="text-sm text-gray-500 truncate">Your package expires soon.</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (appName === 'facebook') {
                title.innerText = "Facebook";
                header.className = "h-12 border-b flex items-center px-4 font-bold shadow-sm z-30 relative transition-colors bg-blue-600 text-white";
                html = `
                    <div class="bg-gray-200 min-h-full">
                        <div class="bg-white p-3 mb-2">
                             <div class="flex gap-2">
                                 <div class="w-8 h-8 bg-gray-300 rounded-full"></div>
                                 <div class="flex-1 bg-gray-100 rounded-full px-3 flex items-center text-sm text-gray-500">What's on your mind?</div>
                             </div>
                        </div>
                        <!-- Post 1 -->
                        <div class="bg-white p-3 mb-2 shadow-sm">
                            <div class="flex gap-2 items-center mb-2">
                                <div class="w-8 h-8 bg-red-100 rounded-full flex items-center justify-center"><i data-lucide="newspaper" class="w-4 h-4 text-red-500"></i></div>
                                <div>
                                    <div class="text-sm font-bold text-gray-800">Yangon News</div>
                                    <div class="text-xs text-gray-400">2 hrs ago</div>
                                </div>
                            </div>
                            <div class="text-sm text-gray-800 mb-2">Heavy rain expected in downtown Yangon this evening. Please drive safely.</div>
                            <div class="w-full h-32 bg-gray-300 rounded mb-2 bg-[url('https://images.unsplash.com/photo-1515347619252-60a6bf4fffce?q=80&w=600&auto=format&fit=crop')] bg-cover bg-center"></div>
                            <div class="border-t pt-2 flex justify-between text-gray-500 text-sm">
                                <span><i data-lucide="thumbs-up" class="inline w-4 h-4 mr-1"></i> Like</span>
                                <span><i data-lucide="message-circle" class="inline w-4 h-4 mr-1"></i> Comment</span>
                                <span><i data-lucide="share" class="inline w-4 h-4 mr-1"></i> Share</span>
                            </div>
                        </div>
                         <!-- Post 2 -->
                        <div class="bg-white p-3 mb-2 shadow-sm">
                            <div class="flex gap-2 items-center mb-2">
                                <div class="w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center">N</div>
                                <div>
                                    <div class="text-sm font-bold text-gray-800">Nay Chi updated her profile picture.</div>
                                    <div class="text-xs text-gray-400">5 hrs ago</div>
                                </div>
                            </div>
                            <div class="w-full h-48 bg-gray-300 rounded mb-2 bg-[url('https://images.unsplash.com/photo-1534528741775-53994a69daeb?q=80&w=600&auto=format&fit=crop')] bg-cover bg-center"></div>
                             <div class="border-t pt-2 flex justify-between text-gray-500 text-sm">
                                <span><i data-lucide="thumbs-up" class="inline w-4 h-4 mr-1"></i> 142</span>
                                <span><i data-lucide="message-circle" class="inline w-4 h-4 mr-1"></i> 12</span>
                            </div>
                        </div>
                    </div>
                `;
            } else if (appName === 'youtube') {
                title.innerText = "YouTube";
                html = `
                    <div class="bg-black text-white min-h-full">
                        <div class="p-2 border-b border-gray-800">
                             <div class="w-full h-40 bg-gray-800 mb-2 bg-[url('https://images.unsplash.com/photo-1492684223066-81342ee5ff30?q=80&w=600&auto=format&fit=crop')] bg-cover bg-center relative">
                                 <div class="absolute bottom-2 right-2 bg-black/80 text-xs px-1 rounded">10:24</div>
                             </div>
                             <div class="flex gap-2">
                                 <div class="w-8 h-8 rounded-full bg-blue-500"></div>
                                 <div class="flex-1">
                                     <div class="text-sm font-bold leading-tight mb-1">Walking in Yangon 4K - Downtown Rain</div>
                                     <div class="text-xs text-gray-400">Myanmar Walks â€¢ 24K views â€¢ 1 day ago</div>
                                 </div>
                             </div>
                        </div>
                        <div class="p-2 border-b border-gray-800">
                             <div class="w-full h-40 bg-gray-800 mb-2 bg-[url('https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?q=80&w=600&auto=format&fit=crop')] bg-cover bg-center relative">
                                  <div class="absolute bottom-2 right-2 bg-black/80 text-xs px-1 rounded">3:45</div>
                             </div>
                             <div class="flex gap-2">
                                 <div class="w-8 h-8 rounded-full bg-red-500"></div>
                                 <div class="flex-1">
                                     <div class="text-sm font-bold leading-tight mb-1">Lofi Myanmar Beats to Study To</div>
                                     <div class="text-xs text-gray-400">Lofi Girl â€¢ 1.2M views â€¢ 1 month ago</div>
                                 </div>
                             </div>
                        </div>
                    </div>
                `;
            } else if (appName === 'photos') {
                title.innerText = "Photos";
                html = `
                    <div class="p-1 grid grid-cols-3 gap-1">
                        <div class="aspect-square bg-gray-200 bg-[url('https://images.unsplash.com/photo-1572508589584-94d778209071?q=80&w=200&auto=format&fit=crop')] bg-cover"></div>
                        <div class="aspect-square bg-gray-200 bg-[url('https://images.unsplash.com/photo-1627993436034-71f496738923?q=80&w=200&auto=format&fit=crop')] bg-cover"></div>
                        <div class="aspect-square bg-gray-200 bg-[url('https://images.unsplash.com/photo-1605218427368-35b0185e33d0?q=80&w=200&auto=format&fit=crop')] bg-cover"></div>
                        <div class="aspect-square bg-gray-200 bg-[url('https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=200&auto=format&fit=crop')] bg-cover"></div>
                        <div class="aspect-square bg-gray-200 bg-[url('https://images.unsplash.com/photo-1596556554483-2079c6131496?q=80&w=200&auto=format&fit=crop')] bg-cover"></div>
                        <div class="aspect-square bg-gray-200 bg-[url('https://images.unsplash.com/photo-1589308078059-be1415eab4c3?q=80&w=200&auto=format&fit=crop')] bg-cover"></div>
                    </div>
                `;
            } else if (appName === 'music') {
                title.innerText = "Spotify"; 
                header.style.display = 'none';
                html = `
                    <div class="h-full flex flex-col bg-gradient-to-b from-gray-900 to-black text-white relative">
                         <div class="flex justify-between items-center p-4 pt-6 z-10">
                            <button onclick="game.phoneHome()" class="text-white hover:bg-white/10 p-1 rounded-full"><i data-lucide="chevron-down" class="w-6 h-6"></i></button>
                            <span class="text-xs font-bold tracking-widest uppercase text-gray-300">Now Playing</span>
                            <button class="text-white"><i data-lucide="more-horizontal" class="w-6 h-6"></i></button>
                         </div>
                         <div class="flex-1 flex items-center justify-center p-6 z-10">
                            <div class="w-full aspect-square bg-gray-800 shadow-2xl rounded-md overflow-hidden relative">
                                <img src="../images/items/song.png" class="w-full h-full object-cover">
                            </div>
                         </div>
                         <div class="px-6 pb-8 z-10 bg-gradient-to-t from-black via-black/50 to-transparent">
                             <div class="flex justify-between items-end mb-6">
                                 <div>
                                     <div class="text-2xl font-bold mb-1">Tejano Blue</div>
                                     <div class="text-gray-400 text-sm">Cigarettes After Sex</div>
                                 </div>
                                 <button class="text-green-500"><i data-lucide="heart" class="w-6 h-6 fill-current"></i></button>
                             </div>
                             <div class="mb-2">
                                 <div class="w-full h-1 bg-gray-600 rounded-full relative cursor-pointer group">
                                     <div id="music-progress" class="absolute left-0 top-0 h-full bg-white rounded-full w-0 transition-all duration-300"></div>
                                     <div class="absolute -top-1.5 -ml-1.5 w-3 h-3 bg-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity" style="left: 0%" id="music-thumb"></div>
                                 </div>
                             </div>
                             <div class="flex justify-between text-xs text-gray-400 font-medium mb-6">
                                 <span id="music-current-time">0:00</span>
                                 <span id="music-duration">0:00</span>
                             </div>
                             <div class="flex justify-between items-center">
                                 <button class="text-gray-400 hover:text-white"><i data-lucide="shuffle" class="w-5 h-5"></i></button>
                                 <button class="text-white hover:scale-110 transition-transform"><i data-lucide="skip-back" class="w-8 h-8 fill-current"></i></button>
                                 <button onclick="game.toggleMusic()" class="w-16 h-16 bg-green-500 rounded-full flex items-center justify-center text-black hover:scale-105 transition-transform shadow-lg shadow-green-500/20">
                                     <i id="music-play-icon" data-lucide="play" class="w-6 h-6 fill-black ml-1"></i>
                                 </button>
                                 <button class="text-white hover:scale-110 transition-transform"><i data-lucide="skip-forward" class="w-8 h-8 fill-current"></i></button>
                                 <button class="text-gray-400 hover:text-white"><i data-lucide="repeat" class="w-5 h-5"></i></button>
                             </div>
                         </div>
                         <audio id="music-player-audio" src="../audios/tejano-blue.mp3" ontimeupdate="game.updateMusicProgress()" onloadedmetadata="game.initMusicDuration()"></audio>
                    </div>
                `;
            } else if (appName === 'kbzpay') {
                title.innerText = "KBZPay";
                header.className = "h-12 border-b flex items-center px-4 font-bold shadow-sm z-30 relative transition-colors bg-blue-700 text-white";
                html = `
                    <div class="flex-1 bg-gray-100 flex flex-col items-center pt-6 relative min-h-full">
                        <div class="w-11/12 bg-blue-600 rounded-xl p-5 shadow-lg mb-6 text-white relative overflow-hidden">
                            <div class="absolute -right-4 -top-4 w-24 h-24 bg-white/10 rounded-full"></div>
                            <span class="text-xs text-blue-100 uppercase tracking-widest">Total Balance</span>
                            <div class="flex items-baseline gap-1 mt-1">
                                <span class="text-3xl font-bold tracking-tight" id="kbz-balance">${this.state.currency.toLocaleString()}</span>
                                <span class="text-sm font-medium text-blue-200">MMK</span>
                            </div>
                            <div class="flex justify-between mt-4">
                                <div class="flex flex-col items-center gap-1 cursor-pointer"><div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i data-lucide="arrow-up" class="w-4 h-4"></i></div><span class="text-[10px]">Transfer</span></div>
                                <div class="flex flex-col items-center gap-1 cursor-pointer"><div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i data-lucide="arrow-down" class="w-4 h-4"></i></div><span class="text-[10px]">Cash In</span></div>
                                <div class="flex flex-col items-center gap-1 cursor-pointer"><div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i data-lucide="qr-code" class="w-4 h-4"></i></div><span class="text-[10px]">Scan</span></div>
                                <div class="flex flex-col items-center gap-1 cursor-pointer"><div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center"><i data-lucide="clock" class="w-4 h-4"></i></div><span class="text-[10px]">History</span></div>
                            </div>
                        </div>
                        <div class="w-11/12">
                            <div class="text-xs text-gray-500 mb-2 uppercase font-bold px-1">Recent Activity</div>
                            <div class="space-y-2" id="kbz-history"></div>
                        </div>
                    </div>
                `;
            }

            contentArea.innerHTML = html;
            activeApp.classList.remove('translate-x-full');
            activeApp.classList.add('app-screen-active');
            
            if (appName === 'kbzpay') {
                this.renderKBZHistory();
            }
            
            lucide.createIcons();
        }

        updateCurrency(amount, transactionId = null) {
            if (amount === 0 && this.state.currency === 0) {
                 const bal = document.getElementById('kbz-balance');
                 if(bal) bal.innerText = "0";
                 return;
            }

            // Centralized Robust Transaction Check
            if (transactionId) {
                if (this.state.flags[`tx_${transactionId}`]) {
                    return; // Prevent duplicate transactions if looping back to same scene/step/choice
                }
                this.state.flags[`tx_${transactionId}`] = true;
            }

            this.state.currency += amount;
            
            const bal = document.getElementById('kbz-balance');
            if(bal) bal.innerText = this.state.currency.toLocaleString();

            if (amount !== 0) {
                const notif = document.getElementById('currency-notification');
                const text = document.getElementById('currency-text');
                const sign = amount > 0 ? '+' : '';
                
                text.innerText = `${sign}${amount.toLocaleString()} MMK`;
                text.className = `text-sm font-bold leading-tight font-mono ${amount > 0 ? 'currency-positive' : 'currency-negative'}`;
                
                notif.classList.add('notification-show');
                setTimeout(() => {
                    notif.classList.remove('notification-show');
                }, 3000);

                if (!this.state.history) this.state.history = [];
                this.state.history.unshift({ amount: amount, date: 'Today' });
                if (this.state.history.length > 5) this.state.history.pop();
                
                if (this.phoneApp === 'kbzpay') {
                    this.renderKBZHistory();
                }
            }
        }
        
        renderKBZHistory() {
            const historyContainer = document.getElementById('kbz-history');
            if (!historyContainer) return;
            
            if (!this.state.history || this.state.history.length === 0) {
                 historyContainer.innerHTML = '<div class="text-center text-xs text-gray-400 py-4">No transactions yet</div>';
                 return;
            }

            historyContainer.innerHTML = '';
            this.state.history.forEach(item => {
                const div = document.createElement('div');
                div.className = "bg-white p-3 rounded-lg flex justify-between items-center shadow-sm border border-gray-100";
                div.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-8 h-8 rounded-full ${item.amount > 0 ? 'bg-green-100' : 'bg-red-100'} flex items-center justify-center">
                            <i data-lucide="${item.amount > 0 ? 'arrow-down-left' : 'arrow-up-right'}" class="w-4 h-4 ${item.amount > 0 ? 'text-green-600' : 'text-red-600'}"></i>
                        </div>
                        <div class="text-xs">
                            <div class="text-gray-800 font-bold">${item.amount > 0 ? 'Received' : 'Payment'}</div>
                            <div class="text-gray-500">${item.date}</div>
                        </div>
                    </div>
                    <span class="text-xs font-mono font-bold ${item.amount > 0 ? 'text-green-600' : 'text-red-600'}">${item.amount > 0 ? '+' : ''}${item.amount.toLocaleString()} MMK</span>
                `;
                historyContainer.appendChild(div);
            });
            lucide.createIcons();
        }

        zoomMap(delta) { 
            if (this.map) {
                const currentZoom = this.map.getZoom();
                this.map.zoomTo(Math.max(10, Math.min(18, currentZoom + (delta > 0 ? 1 : -1))));
            }
        }

        resetZoom() { 
            if (this.map) {
                this.map.flyTo({ center: [96.146480,16.830225], zoom: 12.2 });
            }
        }

        updateMapTransform() { 
            // Handled natively by MapLibre API
        }

        async renderMap() {
            const container = document.getElementById('map-container');
            
            if(!this.map) {
                this.map = new maplibregl.Map({
                    container: 'map-container',
                    style: this.mapStyles[this.currentMapStyle], // Free clean base map without token needed
                    center: [96.1496, 16.7984],
                    zoom: 13,
                    attributionControl: false
                });
            }

            if (this.markers) {
                this.markers.forEach(m => m.remove());
            }
            this.markers = [];

            const currentLoc = LOCATIONS.find(l => l.scene === this.state.sceneId);

            LOCATIONS.forEach(loc => {
                if (!loc.lat || !loc.lng) return;
                
                const isUnlocked = this.state.flags[`${loc.id}_unlocked`];
                const isCurrent = currentLoc && currentLoc.id === loc.id;
                
                const pin = document.createElement('div');
                pin.className = `map-pin-wrapper map-pin ${isUnlocked ? 'map-pin-unlocked' : 'map-pin-locked'}`;

                const iconUrl = ASSETS.icons[loc.type] || ASSETS.icons.city;

                const playerHtml = isCurrent ? `
                    <div class="map-player-indicator">
                        <img src="${ASSETS.icons.player}" class="map-player-avatar">
                        <div class="map-player-arrow"></div>
                    </div>
                ` : '';

                if (isUnlocked) {
                    pin.onclick = (e) => { e.stopPropagation(); this.travelTo(loc); };
                    pin.innerHTML = `
                        ${playerHtml}
                        <div class="map-pin-icon-wrapper">
                            <div class="map-pin-shadow"></div>
                            <img src="${iconUrl}" class="map-pin-img" alt="${loc.name.en}">
                            <div class="map-pin-label">
                                ${loc.name[this.state.lang] || loc.name.en}
                            </div>
                        </div>
                    `;
                } else {
                    pin.innerHTML = `
                        <div class="map-pin-locked-wrap">
                            <img src="${iconUrl}" class="map-pin-locked-img" alt="${loc.name.en}">
                            <div class="map-pin-lock-icon"><i data-lucide="lock" class="w-3 h-3"></i></div>
                            <div class="map-pin-locked-label">
                                ${loc.name[this.state.lang] || loc.name.en}
                            </div>
                        </div>
                    `;
                }

                const marker = new maplibregl.Marker({ element: pin, anchor: 'bottom' })
                    .setLngLat([loc.lng, loc.lat])
                    .addTo(this.map);
                
                this.markers.push(marker);
            });
            
            lucide.createIcons();
        }

        travelTo(loc) {
            this.toggleMap();
            if (SCENES[loc.scene]) { this.loadScene(loc.scene); } else { alert(`Development Mode: Scene for ${loc.name.en} is not yet implemented.`); }
        }

        showUnlockNotification(locId) {
            const loc = LOCATIONS.find(l => l.id === locId);
            if (!loc) return;
            const notif = document.getElementById('unlock-notification');
            const text = document.getElementById('unlock-text');
            text.innerText = loc.name[this.state.lang] || loc.name.en;
            notif.classList.add('notification-show');
            setTimeout(() => { notif.classList.remove('notification-show'); }, 4000);
        }

        toggleFullscreen() {
            if (!document.fullscreenElement) { document.documentElement.requestFullscreen().catch(err => { console.log(`Error: ${err.message}`); }); } 
            else { if (document.exitFullscreen) { document.exitFullscreen(); } }
        }
        
        toggleImmersive() {
            this.immersiveMode = !this.immersiveMode;
            const ui = document.getElementById('ui-layer');
            const cam = document.getElementById('camera-rig');
            
            if (this.immersiveMode) {
                if (document.documentElement.requestFullscreen) { document.documentElement.requestFullscreen().catch(err => console.log(err)); }
                ui.classList.add('hidden');
                cam.classList.add('static-cam');
                const exitHandler = (e) => { e.stopPropagation(); this.toggleImmersive(); document.removeEventListener('click', exitHandler, true); };
                setTimeout(() => { document.addEventListener('click', exitHandler, true); }, 50);
            } else {
                if (document.exitFullscreen && document.fullscreenElement) { document.exitFullscreen().catch(err => console.log(err)); }
                ui.classList.remove('hidden');
                cam.classList.remove('static-cam');
            }
        }

        takeScreenshot() {
            const ui = document.getElementById('ui-layer');
            const cam = document.getElementById('camera-rig');
            const container = document.getElementById('game-container');
            ui.classList.add('hidden');
            cam.classList.add('static-cam');
            setTimeout(() => {
                html2canvas(container, { scale: 2, useCORS: true, backgroundColor: null }).then(canvas => {
                    const link = document.createElement('a'); link.download = `yangon_scene_${Date.now()}.png`; link.href = canvas.toDataURL(); link.click();
                    ui.classList.remove('hidden');
                    if (!this.immersiveMode) { cam.classList.remove('static-cam'); }
                }).catch(err => {
                    console.error("Screenshot failed:", err); alert("Couldn't take screenshot due to browser security restrictions.");
                    ui.classList.remove('hidden');
                    if (!this.immersiveMode) cam.classList.remove('static-cam');
                });
            }, 100);
        }

        saveGameManual() {
            localStorage.setItem('ringGameSave_V5', JSON.stringify(this.state));
            const btn = document.querySelector('button[onclick="game.saveGameManual()"]');
            if (btn) {
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i data-lucide="check" class="text-green-400 w-3 h-3 md:w-4 md:h-4"></i>';
                lucide.createIcons();
                setTimeout(() => { btn.innerHTML = originalHTML; lucide.createIcons(); }, 1000);
            }
        }

        loadGame() {
            const save = localStorage.getItem('ringGameSave_V5');
            if (save) {
                this.state = JSON.parse(save);
                if (this.state.currency === undefined) this.state.currency = 0;
                if (!this.state.settings) this.state.settings = { volume: 1.0, themeVolume: 0.4, gameAudio: 'on', fontSize: 'medium', graphics: 'high', theme: 'dark' };
                this.applySettings();
                document.getElementById('start-screen').classList.add('hidden');
                document.getElementById('ui-layer').classList.remove('hidden');
                document.getElementById('ui-layer').classList.add('flex');
                this.loadScene(this.state.sceneId);
                this.updateCurrency(0); 
            }
        }

        toggleLang() { this.setLanguage(this.state.lang === 'mm' ? 'en' : 'mm'); }
        
        toggleAuto() {
            this.autoPlay = !this.autoPlay;
            const btn = document.getElementById('auto-btn');
            if (this.autoPlay) {
                btn.classList.add('active-mode');
                if (!this.isTyping && !this.isLastStep()) { this.next(); }
            } else {
                btn.classList.remove('active-mode');
                if (this.autoPlayTimer) clearTimeout(this.autoPlayTimer);
            }
            lucide.createIcons();
        }

        openSettings() {
            const modal = document.getElementById('settings-modal');
            this.renderSettingsText();
            this.syncSettingsUI();
            modal.classList.remove('hidden');
            void modal.offsetWidth; 
            modal.classList.remove('opacity-0');
            this.settingsOpen = true;
            lucide.createIcons();
        }

        closeSettings() {
            const modal = document.getElementById('settings-modal');
            modal.classList.add('opacity-0');
            setTimeout(() => { modal.classList.add('hidden'); }, 300);
            this.settingsOpen = false;
            this.saveGameManual(); 
        }

        applySettings() {
            this.setVolume(this.state.settings.volume, false);
            this.setThemeVolume(this.state.settings.themeVolume !== undefined ? this.state.settings.themeVolume : 0.4, false);
            this.setGameAudio(this.state.settings.gameAudio || 'on', false);
            this.setFontSize(this.state.settings.fontSize, false);
            this.setGraphics(this.state.settings.graphics, false);
            this.setTheme(this.state.settings.theme, false);
            this.syncSettingsUI();
        }

        syncSettingsUI() {
            document.getElementById('ga-vol-slider').value = this.state.settings.volume;
            document.getElementById('tm-vol-slider').value = this.state.settings.themeVolume !== undefined ? this.state.settings.themeVolume : 0.4;
            this.updateBtnGroup('ga', this.state.settings.gameAudio || 'on');
            this.updateBtnGroup('font', this.state.settings.fontSize);
            this.updateBtnGroup('gfx', this.state.settings.graphics);
            this.updateBtnGroup('lang', this.state.lang);
            this.updateBtnGroup('theme', this.state.settings.theme);
        }

        updateBtnGroup(group, val) {
            const btns = document.querySelectorAll(`.st-btn-${group}`);
            btns.forEach(btn => {
                if (btn.dataset.val === val) { btn.classList.add('st-btn-active'); } 
                else { btn.classList.remove('st-btn-active'); }
            });
        }

        renderSettingsText() {
            const lang = this.state.lang;
            document.getElementById('lang-btn').innerText = lang === 'mm' ? "á€™á€¼á€”á€ºá€™á€¬" : "EN";
            const updateText = (id, key) => { const el = document.getElementById(id); if (el && SETTINGS_DICT[key]) el.innerText = SETTINGS_DICT[key][lang]; };
            updateText('st-menu-new', 'menu_new'); updateText('st-menu-load', 'menu_load'); updateText('st-menu-gallery', 'menu_gallery');
            updateText('st-menu-set', 'menu_set'); updateText('st-menu-quit', 'menu_quit'); updateText('st-menu-credits', 'menu_credits');
            updateText('st-menu-terms', 'menu_terms'); updateText('hud-st-tip', 'menu_set'); updateText('hud-quit-tip', 'hud_quit');
            updateText('st-title', 'title'); updateText('st-ga-vol', 'ga_vol'); updateText('st-ga-vol-tip', 'ga_vol_tip');
            updateText('st-tm-vol', 'tm_vol'); updateText('st-tm-vol-tip', 'tm_vol_tip'); updateText('st-ga-state', 'ga_state');
            updateText('st-ga-state-tip', 'ga_state_tip'); updateText('st-ga-on', 'ga_on'); updateText('st-ga-off', 'ga_off');
            updateText('st-font', 'font_size'); updateText('st-font-tip', 'font_tip'); updateText('st-font-sm', 'font_sm');
            updateText('st-font-md', 'font_md'); updateText('st-font-lg', 'font_lg'); updateText('st-gfx', 'graphics');
            updateText('st-gfx-tip', 'gfx_tip'); updateText('st-gfx-low', 'gfx_low'); updateText('st-gfx-med', 'gfx_med');
            updateText('st-gfx-high', 'gfx_high'); updateText('st-lang', 'language'); updateText('st-lang-tip', 'lang_tip');
            updateText('st-theme', 'theme'); updateText('st-theme-tip', 'theme_tip'); updateText('st-theme-dark', 'theme_dark');
            updateText('st-theme-light', 'theme_light');
        }

        setVolume(val, sync = true) { this.state.settings.volume = parseFloat(val); this.audio.setVolume(this.state.settings.volume); if(sync) this.syncSettingsUI(); }
        setThemeVolume(val, sync = true) { this.state.settings.themeVolume = parseFloat(val); this.audio.setThemeVolume(this.state.settings.themeVolume); if(sync) this.syncSettingsUI(); }
        setGameAudio(state, sync = true) { this.state.settings.gameAudio = state; this.audio.setGameAudio(state); if(sync) this.syncSettingsUI(); }
        setFontSize(size, sync = true) {
            this.state.settings.fontSize = size;
            document.body.classList.remove('font-sm', 'font-lg');
            if (size === 'small') document.body.classList.add('font-sm');
            if (size === 'large') document.body.classList.add('font-lg');
            if(sync) this.syncSettingsUI();
        }
        setGraphics(level, sync = true) {
            this.state.settings.graphics = level;
            document.body.classList.remove('gfx-low', 'gfx-med', 'gfx-high');
            if (level === 'low') document.body.classList.add('gfx-low');
            if (level === 'medium') document.body.classList.add('gfx-med');
            if (level === 'high') document.body.classList.add('gfx-high');
            if(sync) this.syncSettingsUI();
        }
        setTheme(mode, sync = true) {
            this.state.settings.theme = mode;
            document.body.classList.remove('theme-light');
            if (mode === 'light') { document.body.classList.add('theme-light'); }
            if(sync) this.syncSettingsUI();
        }
        setLanguage(lang) { this.state.lang = lang; this.renderSettingsText(); this.syncSettingsUI(); if (!this.isTyping && this.sceneData) this.renderStep(true); }

        changeBackground(bgKey, darken) {
            const url = ASSETS.bg[bgKey];
            if (!url) return;
            if (this.currentBgKey === bgKey) return;
            if (!this.activeLayer) this.activeLayer = 1;
            const nextLayerIdx = this.activeLayer === 1 ? 2 : 1;
            const currentEl = document.getElementById(`bg-layer-${this.activeLayer}`);
            const nextEl = document.getElementById(`bg-layer-${nextLayerIdx}`);
            const targetOpacity = darken ? '0.3' : '0.6';
            nextEl.style.backgroundImage = `url('${url}')`;
            nextEl.style.opacity = targetOpacity;
            currentEl.style.opacity = '0';
            this.activeLayer = nextLayerIdx;
            this.currentBgKey = bgKey; 
        }

        handleAudio(audioData) {
            if (!audioData) return;
            const id = typeof audioData === 'string' ? audioData : audioData.id;
            const loop = typeof audioData === 'string' ? true : (audioData.loop !== undefined ? audioData.loop : true);
            this.audio.play(id, loop);
        }

        loadScene(id) {
            this.state.sceneId = id;
            this.sceneData = SCENES[id];
            this.dialogueIndex = 0;

            this.changeBackground(this.sceneData.bg, this.sceneData.darken);
            this.handleAudio(this.sceneData.audio);

            const baseClasses = "text-gray-100 h-screen w-screen relative select-none bg-black transition-colors duration-1000";
            const settingsClasses = [];
            if(this.state.settings.fontSize === 'small') settingsClasses.push('font-sm');
            if(this.state.settings.fontSize === 'large') settingsClasses.push('font-lg');
            if(this.state.settings.graphics === 'low') settingsClasses.push('gfx-low');
            if(this.state.settings.graphics === 'medium') settingsClasses.push('gfx-med');
            if(this.state.settings.graphics === 'high') settingsClasses.push('gfx-high');
            if(this.state.settings.theme === 'light') settingsClasses.push('theme-light');
            
            document.body.className = `${baseClasses} ${settingsClasses.join(' ')}`;
            if (this.sceneData.world) document.body.classList.add(`world-${this.sceneData.world}`);
            if (this.sceneData.location) {
                document.getElementById('location-text').innerText = this.sceneData.location.en; 
                document.getElementById('time-text').innerText = `DAY ${this.state.day} - ${this.sceneData.time || 'UNKNOWN'}`;
            }

            this.renderStep();
            this.saveGameManual();
        }

        renderStep(instant = false) {
            if (this.typingTimer) clearTimeout(this.typingTimer);
            if (this.autoPlayTimer) clearTimeout(this.autoPlayTimer);

            const step = this.sceneData.steps[this.dialogueIndex];
            if (!step) return;

            if (step.unlock) {
                const locationsToUnlock = Array.isArray(step.unlock) ? step.unlock : [step.unlock];
                locationsToUnlock.forEach(locId => {
                    if (!this.state.flags[`${locId}_unlocked`]) {
                        this.state.flags[`${locId}_unlocked`] = true;
                        this.showUnlockNotification(locId);
                    }
                });
            }

            // Enhanced Centralized Currency System trigger
            if (step.currency) {
                const txId = `currency_${this.state.sceneId}_step_${this.dialogueIndex}`;
                this.updateCurrency(step.currency, txId);
            }
            
            if (step.bg) { this.changeBackground(step.bg, this.sceneData.darken); }
            if (step.audio) { this.handleAudio(step.audio); }

            const speakerBox = document.getElementById('speaker-box');
            const speakerName = document.getElementById('speaker-name');
            const spk = step.speaker ? (step.speaker[this.state.lang] || step.speaker.en) : null;
            
            if (spk) {
                speakerBox.classList.remove('hidden');
                speakerName.innerText = spk;
                const spkColorClass = step.speaker.color || 'speaker-color-default';
                speakerBox.className = `bg-gray-900 px-6 py-1.5 text-xs md:text-sm font-bold tracking-[0.2em] text-yellow-500 uppercase transform skew-x-[-12deg] shadow-[0_5px_20px_rgba(0,0,0,0.5)] border border-yellow-500/50 transition-colors ${spkColorClass}`;
            } else {
                speakerBox.classList.add('hidden');
            }

            const charLayer = document.getElementById('character-layer');
            if (step.char) {
                charLayer.innerHTML = this.getCharHTML(step.char);
                charLayer.classList.remove('opacity-0', 'translate-y-10');
            } else if (step.clearChar) {
                charLayer.classList.add('opacity-0', 'translate-y-10');
            }

            const textBox = document.getElementById('dialogue-text');
            const text = step.text[this.state.lang] || step.text.en;
            const choicesDiv = document.getElementById('choices-container');
            const nextInd = document.getElementById('next-indicator');

            choicesDiv.innerHTML = '';
            nextInd.style.opacity = '0';

            if (instant) {
                textBox.innerText = text;
                this.isTyping = false;
                textBox.classList.remove('cursor');
                if (this.isLastStep()) {
                    this.renderChoices();
                    if(this.autoPlayTimer) clearTimeout(this.autoPlayTimer); 
                } else {
                    nextInd.style.opacity = '1';
                    if (this.autoPlay) {
                        const delay = 1500 + (text.length * 50);
                        this.autoPlayTimer = setTimeout(() => this.next(), delay);
                    }
                }
                return;
            }

            textBox.innerText = '';
            textBox.classList.add('cursor');
            this.isTyping = true;
            let i = 0;

            const tick = () => {
                if (!this.isTyping) return; 
                if (i < text.length) {
                    textBox.innerText += text.charAt(i);
                    i++;
                    this.typingTimer = setTimeout(tick, this.typingSpeed);
                } else {
                    this.isTyping = false;
                    textBox.classList.remove('cursor');
                    if (this.isLastStep()) {
                        this.renderChoices();
                        if(this.autoPlayTimer) clearTimeout(this.autoPlayTimer); 
                    } else {
                        nextInd.style.opacity = '1';
                        if (this.autoPlay) {
                            const delay = 1500 + (text.length * 50);
                            this.autoPlayTimer = setTimeout(() => this.next(), delay);
                        }
                    }
                }
            };
            tick();
        }

        isLastStep() { return this.dialogueIndex === this.sceneData.steps.length - 1 && this.sceneData.choices; }

        renderChoices() {
            const container = document.getElementById('choices-container');
            container.innerHTML = '';

            this.sceneData.choices.forEach(c => {
                if (c.req && !c.req(this.state)) return; 
                const btn = document.createElement('button');
                btn.className = "choice-btn w-full max-w-3xl p-3 md:p-4 text-left rounded-r-lg mb-2 relative overflow-hidden group transition-all duration-300";
                const txt = c.text[this.state.lang] || c.text.en;
                btn.innerHTML = `
                    <div style="position:relative; z-index:10; display:flex; justify-content:space-between; align-items:center;">
                        <span style="font-family:'Noto Sans Myanmar', sans-serif; font-weight:bold;">${txt}</span>
                        ${c.type === 'danger' ? '<i data-lucide="alert-triangle" style="color:#ef4444; width:1rem; height:1rem;"></i>' : '<i data-lucide="arrow-right" style="color:#eab308; width:1rem; height:1rem; opacity:0; transition:opacity 0.3s;" class="choice-arrow"></i>'}
                    </div>
                `;
                if (c.type === 'danger') btn.style.borderLeftColor = '#ef4444';
                
                // Add hover style simulation for arrow
                btn.addEventListener('mouseenter', () => { const icon = btn.querySelector('.choice-arrow'); if(icon) icon.style.opacity = '1'; });
                btn.addEventListener('mouseleave', () => { const icon = btn.querySelector('.choice-arrow'); if(icon) icon.style.opacity = '0'; });

                btn.onclick = (e) => { e.stopPropagation(); this.makeChoice(c); };
                container.appendChild(btn);
            });
            lucide.createIcons();
        }

        next() {
            if (this.isTyping) { this.renderStep(true); return; }
            if (document.getElementById('choices-container').children.length > 0) return;
            if (this.dialogueIndex < this.sceneData.steps.length - 1) { this.dialogueIndex++; this.renderStep(); } 
            else if (this.sceneData.nextScene) { this.loadScene(this.sceneData.nextScene); }
        }

        makeChoice(choice) {
            if (choice.unlock) {
                const locationsToUnlock = Array.isArray(choice.unlock) ? choice.unlock : [choice.unlock];
                locationsToUnlock.forEach(locId => {
                    if (!this.state.flags[`${locId}_unlocked`]) { this.state.flags[`${locId}_unlocked`] = true; this.showUnlockNotification(locId); }
                });
            }
            // Enhanced Centralized Currency System trigger for choices
            if (choice.currency) {
                const txId = `currency_${this.state.sceneId}_choice_${this.sceneData.choices.indexOf(choice)}`;
                this.updateCurrency(choice.currency, txId);
            }
            if (choice.effect) { for (const [k, v] of Object.entries(choice.effect)) { this.state.stats[k] = Math.max(0, Math.min(100, this.state.stats[k] + v)); } }
            if (choice.flag) this.state.flags[choice.flag] = true;
            if (choice.next) this.loadScene(choice.next);
        }

        flashEffect() {
            const flash = document.getElementById('flash-layer');
            flash.style.animation = 'none';
            flash.offsetHeight; 
            flash.style.animation = 'flash-anim 0.5s ease-out';
        }

        getCharHTML(type) {
            const maps = {
                naychi: `<div class="char-naychi-wrapper"><div class="char-naychi-glow"></div><div class="char-naychi-body"></div></div>`,
                faceless: `<div class="char-faceless-wrapper"><div class="char-faceless-body"></div><div class="char-faceless-head"></div></div>`,
                faceless_mom: `<div class="char-mom-wrapper"><div class="char-mom-body"></div><div class="char-mom-head"></div></div>`,
                monk: `<div class="char-monk-wrapper"><div class="char-monk-body"></div></div>`
            };
            return maps[type] || '';
        }
    }

    class AudioController {
        constructor() { 
            this.active = true; this.current = null; this.volume = 1.0; this.themeVolume = 0.4; this.gameAudioActive = true;
            this.themeMusic = new Audio(ASSETS.audio.main_theme || "../audios/theme.mp3"); this.themeMusic.loop = true;
        } 
        setVolume(v) { this.volume = v; if(this.bgMusic) this.bgMusic.volume = this.volume; }
        setThemeVolume(v) {
            this.themeVolume = v; if(this.themeMusic) this.themeMusic.volume = this.themeVolume;
            if (this.themeVolume > 0 && this.themeMusic.paused && this.active) { this.themeMusic.play().catch(e => console.log("Audio autoplay blocked by browser")); } 
            else if (this.themeVolume == 0 && !this.themeMusic.paused) { this.themeMusic.pause(); }
        }
        setGameAudio(state) {
            this.gameAudioActive = (state === 'on');
            if (this.gameAudioActive && this.active && this.bgMusic && this.bgMusic.paused) { this.bgMusic.play().catch(e => console.log("Audio autoplay blocked by browser")); } 
            else if (!this.gameAudioActive && this.bgMusic) { this.bgMusic.pause(); }
        }
        toggle() {
            this.active = !this.active;
            const icon = document.getElementById('audio-icon');
            if (this.active) {
                icon.setAttribute('data-lucide', 'volume-2'); icon.style.color = '#facc15'; 
                if(this.current && this.bgMusic && this.gameAudioActive) this.bgMusic.play().catch(e => console.log("Audio autoplay blocked"));
                if(this.themeMusic && this.themeVolume > 0) this.themeMusic.play().catch(e => console.log("Audio autoplay blocked"));
            } else {
                icon.setAttribute('data-lucide', 'volume-x'); icon.style.color = 'inherit';
                if(this.bgMusic) this.bgMusic.pause(); if(this.themeMusic) this.themeMusic.pause();
            }
            lucide.createIcons();
        }
        play(id, loop = true) {
            if (!this.bgMusic) { this.bgMusic = new Audio(); }
            this.bgMusic.loop = loop; this.bgMusic.volume = this.volume;
            if (this.current !== id) {
                 this.bgMusic.src = ASSETS.audio[id]; this.current = id;
                 if (this.active && this.gameAudioActive) this.bgMusic.play().catch(e => console.log("Audio autoplay blocked"));
            } else {
                 if (this.active && this.gameAudioActive && this.bgMusic.paused) {
                     this.bgMusic.currentTime = 0; this.bgMusic.play().catch(e => console.log("Audio autoplay blocked"));
                 }
            }
        }
    }

    const SPEAKERS = {
        unknown: { en: "???", mm: "???", color: "bg-brown-900 border-brown-500" },
        tayza: { en: "Tayza", mm: "á€á€±á€‡", color: "bg-blue-900 border-blue-500" },
        nay: { en: "Nay Chi", mm: "á€”á€±á€á€¼á€Šá€º", color: "bg-purple-900 border-purple-500" },
        mom: { en: "Mother", mm: "á€¡á€™á€±", color: "bg-orange-800 border-orange-500" },
        dad: { en: "Father", mm: "á€¡á€–á€±", color: "bg-orange-900 border-orange-500" },
        bro: { en: "Ko Thiha", mm: "á€€á€­á€¯á€žá€®á€Ÿ", color: "bg-green-900 border-green-500" },
        kyaw: { en: "Kyaw Gyi", mm: "á€€á€»á€±á€¬á€ºá€€á€¼á€®á€¸", color: "bg-teal-800 border-teal-500" },
        nurse: { en: "Nurse", mm: "á€žá€°á€”á€¬á€•á€¼á€¯", color: "bg-pink-900 border-pink-500" },
        guard: { en: "The Guardian", mm: "á€¡á€…á€±á€¬á€„á€·á€º", color: "bg-red-900 border-red-500" },
        driver: { en: "YBS Driver", mm: "á€€á€¬á€¸á€†á€›á€¬", color: "bg-gray-800 border-gray-500" },
        monk: { en: "Sayadaw", mm: "á€†á€›á€¬á€á€±á€¬á€º", color: "bg-orange-900 border-yellow-500" },
        librarian: { en: "Librarian", mm: "á€…á€¬á€€á€¼á€Šá€·á€ºá€á€­á€¯á€€á€ºá€™á€¾á€°á€¸", color: "bg-indigo-900 border-indigo-500" }
    };
    const SCENES = {
        'yangon_intro': {
            bg: 'downtown',
            world: 'real',
            audio: 'morning_chant',
            location: { en: 'Yangon - CityView', mm: 'á€›á€”á€ºá€€á€¯á€”á€º - á€™á€¼á€­á€¯á€·á€¡á€œá€¾' },
            time: '07:00 AM',
            steps: [
            {
                bg: 'downtown',
                text: {
                    en: "Morning light spills over Yangon Downtown, brushing colonial buildings and narrow streets with gold. Shops awaken, tea scents drift, and buses begin their slow dance along waking roads. The city hums with quiet stories beneath the sun.",
                    mm: "á€™á€”á€€á€ºá€á€„á€ºá€¸á€”á€±á€›á€±á€¬á€„á€ºá€€ á€›á€”á€ºá€€á€¯á€”á€ºá€™á€¼á€­á€¯á€·á€œá€šá€ºá€•á€±á€«á€ºá€€á€­á€¯ á€á€–á€¼á€Šá€ºá€¸á€–á€¼á€Šá€ºá€¸ á€œá€„á€ºá€¸á€œá€¬á€•á€¼á€®á€¸ á€Ÿá€±á€¬á€„á€ºá€¸á€”á€½á€™á€ºá€¸á€”á€±á€žá€±á€¬á€€á€­á€¯á€œá€­á€¯á€”á€®á€¡á€†á€±á€¬á€€á€ºá€¡á€¦á€¸á€á€½á€±áŠ á€œá€™á€ºá€¸á€€á€»á€‰á€ºá€¸á€€á€»á€‰á€ºá€¸á€œá€±á€¸á€á€½á€±á€€á€­á€¯ á€›á€±á€¬á€„á€ºá€…á€¯á€¶á€¡á€œá€„á€ºá€¸á€”á€²á€· á€œá€„á€ºá€¸á€…á€±á€•á€«á€á€šá€ºá‹ á€†á€­á€¯á€„á€ºá€á€½á€± á€á€–á€¼á€Šá€ºá€¸á€–á€¼á€Šá€ºá€¸á€–á€½á€„á€·á€ºá€œá€¬á€€á€¼á€•á€¼á€®á€¸ á€œá€€á€ºá€–á€€á€ºá€›á€Šá€ºá€”á€¶á€·á€œá€±á€¸á€á€½á€±á€œá€Šá€ºá€¸ á€œá€±á€‘á€²á€™á€¾á€¬ á€•á€»á€¶á€·á€”á€¾á€¶á€·á€œá€¬á€•á€«á€•á€¼á€®á‹ á€˜á€á€ºá€…á€ºá€€á€¬á€¸á€á€½á€±á€€á€œá€Šá€ºá€¸ á€œá€™á€ºá€¸á€™á€•á€±á€«á€ºá€™á€¾á€¬ á€á€–á€¼á€Šá€ºá€¸á€–á€¼á€Šá€ºá€¸ á€…á€á€„á€ºá€œá€¾á€¯á€•á€ºá€›á€¾á€¬á€¸á€œá€¬á€•á€¼á€®á€¸ á€™á€¼á€­á€¯á€·á€á€±á€¬á€ºá€‘á€² á€”á€±á€›á€±á€¬á€„á€ºá€¡á€±á€¬á€€á€ºá€™á€¾á€¬ á€œá€°á€á€­á€¯á€„á€ºá€¸á€€á€­á€¯á€šá€ºá€•á€­á€¯á€„á€ºá€‡á€¬á€á€ºá€œá€™á€ºá€¸á€á€½á€±á€”á€²á€· á€á€­á€á€ºá€á€†á€­á€á€º á€…á€á€„á€ºá€œá€¬á€•á€«á€•á€¼á€®á‹"
                }
            },
            {
                bg: 'sule',
                text: {
                    en: "At the heart of the city, Sule Pagoda stands serene amid flowing traffic. Monks walk with calm steps, office workers hurry by. Its golden spire catches sunlight, quietly witnessing the passing day.",
                    mm: "á€™á€¼á€­á€¯á€·á€›á€²á€·á€¡á€œá€šá€ºá€—á€Ÿá€­á€¯á€™á€¾á€¬ á€†á€°á€¸á€œá€±á€˜á€¯á€›á€¬á€¸á€€ á€œá€™á€ºá€¸á€œá€¾á€Šá€·á€ºá€€á€¬á€¸á€á€½á€±á€€á€¼á€¬á€¸á€™á€¾á€¬á€•á€² á€á€­á€á€ºá€†á€­á€á€ºá€¡á€±á€¸á€á€»á€™á€ºá€¸á€…á€½á€¬ á€á€Šá€ºá€›á€¾á€­á€”á€±á€•á€¼á€®á€¸ á€”á€±á€›á€±á€¬á€„á€ºá€¡á€±á€¬á€€á€ºá€™á€¾á€¬ á€›á€½á€¾á€±á€›á€±á€¬á€„á€ºá€á€±á€¬á€€á€ºá€•á€œá€„á€ºá€¸á€œá€€á€ºá€”á€±á€•á€«á€á€šá€ºá‹ á€žá€¶á€ƒá€¬á€á€±á€¬á€ºá€á€½á€±á€€ á€á€Šá€ºá€„á€¼á€­á€™á€ºá€á€²á€· á€á€¼á€±á€œá€¾á€™á€ºá€¸á€á€½á€±á€”á€²á€· á€œá€™á€ºá€¸á€œá€»á€¾á€±á€¬á€€á€ºá€”á€±á€€á€¼á€•á€¼á€®á€¸ á€›á€¯á€¶á€¸á€žá€½á€¬á€¸á€á€”á€ºá€‘á€™á€ºá€¸á€á€½á€±á€€á€œá€Šá€ºá€¸ á€¡á€œá€¯á€•á€ºá€¡á€á€½á€€á€º á€¡á€™á€¼á€”á€ºá€œá€¾á€¯á€•á€ºá€›á€¾á€¬á€¸á€”á€±á€€á€¼á€•á€«á€•á€¼á€®á‹ á€™á€¼á€­á€¯á€·á€›á€²á€·á€¡á€žá€¶á€œá€¾á€­á€¯á€„á€ºá€¸á€á€½á€±á€€á€¼á€¬á€¸á€™á€¾á€¬á€•á€„á€º á€˜á€¯á€›á€¬á€¸á€€ á€á€­á€á€ºá€á€†á€­á€á€º á€”á€±á€·á€žá€…á€ºá€á€…á€ºá€”á€±á€·á€€á€­á€¯ á€…á€±á€¬á€„á€·á€ºá€€á€¼á€Šá€·á€ºá€”á€±á€žá€œá€­á€¯ á€–á€¼á€…á€ºá€”á€±á€•á€«á€á€šá€ºá‹"
                }
            },
            {
                bg: 'shwedagon',
                text: {
                    en: "On the hill, Shwedagon Pagoda glimmers under the sun. Incense drifts, prayers float, and the city below seems to pause, held in a gentle, timeless moment.",
                    mm: "á€á€±á€¬á€„á€ºá€•á€±á€«á€ºá€™á€¾á€¬ á€›á€½á€¾á€±á€á€­á€‚á€¯á€¶á€˜á€¯á€›á€¬á€¸á€€ á€”á€±á€›á€±á€¬á€„á€ºá€¡á€±á€¬á€€á€ºá€™á€¾á€¬ á€á€±á€¬á€€á€ºá€•á€œá€„á€ºá€¸á€œá€€á€ºá€”á€±á€•á€¼á€®á€¸ á€›á€½á€¾á€±á€›á€±á€¬á€„á€ºá€á€¶á€á€­á€¯á€„á€ºá€¸á€á€½á€±á€€ á€™á€»á€€á€ºá€…á€­á€‘á€² á€‘á€„á€ºá€Ÿá€•á€ºá€…á€±á€•á€«á€á€šá€ºá‹ á€¡á€™á€½á€¾á€±á€¸á€”á€¶á€·á€žá€„á€ºá€¸á€žá€„á€ºá€¸á€œá€±á€¸á€á€½á€± á€œá€±á€‘á€²á€™á€¾á€¬ á€•á€»á€¶á€·á€”á€¾á€¶á€·á€”á€±á€•á€¼á€®á€¸ á€†á€¯á€á€±á€¬á€„á€ºá€¸á€žá€¶á€á€½á€±á€€á€œá€Šá€ºá€¸ á€á€­á€á€ºá€á€†á€­á€á€º á€œá€±á€•á€¼á€±á€¡á€±á€¸á€”á€²á€·á€¡á€á€° á€•á€±á€«á€ºá€œá€½á€„á€ºá€”á€±á€•á€«á€á€šá€ºá‹ á€¡á€±á€¬á€€á€ºá€˜á€€á€ºá€™á€¼á€­á€¯á€·á€á€±á€¬á€ºá€€á€á€±á€¬á€· á€á€á€á€¬ á€„á€¼á€­á€™á€ºá€žá€€á€ºá€žá€œá€­á€¯ á€–á€¼á€…á€ºá€”á€±á€•á€¼á€®á€¸ á€¡á€á€»á€­á€”á€ºá€á€…á€ºá€á€ á€›á€•á€ºá€á€”á€ºá€·á€žá€½á€¬á€¸á€žá€œá€­á€¯ á€¡á€±á€¸á€á€»á€™á€ºá€¸á€™á€¾á€¯á€á€…á€ºá€á€¯á€”á€²á€· á€–á€¯á€¶á€¸á€œá€½á€¾á€™á€ºá€¸á€”á€±á€•á€«á€á€šá€ºá‹"
                }
            },
            {
                bg: 'kantawgyi',
                text: {
                    en: "By Kandawgyi Lake, water mirrors clouds and rooftops. The Karaweik floats gently, footsteps fade along the wooden path, and a soft breeze carries distant city sounds. Peace lingers quietly beneath the open sky.",
                    mm: "á€€á€”á€ºá€á€±á€¬á€ºá€€á€¼á€®á€¸á€€á€”á€ºá€˜á€±á€¸á€™á€¾á€¬ á€›á€±á€•á€¼á€„á€ºá€€ á€™á€­á€¯á€¸á€á€­á€™á€ºá€á€½á€±á€”á€²á€· á€¡á€†á€±á€¬á€€á€ºá€¡á€¦á€¸á€á€½á€±á€€á€­á€¯ á€•á€¼á€”á€ºá€œá€Šá€ºá€‘á€„á€ºá€Ÿá€•á€ºá€…á€±á€•á€¼á€®á€¸ á€œá€±á€•á€¼á€±á€¡á€±á€¸á€œá€±á€¸á€”á€²á€·á€¡á€á€° á€á€­á€á€ºá€†á€­á€á€ºá€…á€½á€¬ á€œá€¾á€¯á€•á€ºá€›á€¾á€¬á€¸á€”á€±á€•á€«á€á€šá€ºá‹ á€€á€›á€á€­á€€á€ºá€›á€±á€šá€¬á€‰á€ºá€€ á€›á€±á€•á€¼á€„á€ºá€•á€±á€«á€ºá€™á€¾á€¬ á€„á€¼á€­á€™á€ºá€žá€€á€ºá€…á€½á€¬ á€œá€½á€„á€·á€ºá€™á€»á€±á€¬á€”á€±á€•á€¼á€®á€¸ á€žá€…á€ºá€žá€¬á€¸á€œá€™á€ºá€¸á€œá€±á€¸á€•á€±á€«á€ºá€™á€¾á€¬ á€œá€™á€ºá€¸á€œá€»á€¾á€±á€¬á€€á€ºá€žá€¶á€á€½á€±áŠ á€™á€¼á€­á€¯á€·á€›á€²á€·á€¡á€žá€¶á€á€±á€¸á€á€±á€¸á€œá€±á€¸á€á€½á€± á€œá€±á€•á€¼á€±á€¡á€±á€¸á€”á€²á€·á€¡á€á€° á€€á€¼á€¬á€¸á€”á€±á€›á€•á€¼á€®á€¸ á€¡á€±á€¸á€á€»á€™á€ºá€¸á€™á€¾á€¯á€á€…á€ºá€á€¯á€€á€á€±á€¬á€· á€™á€­á€¯á€¸á€€á€±á€¬á€„á€ºá€¸á€€á€„á€ºá€¡á€±á€¬á€€á€ºá€™á€¾á€¬ á€á€­á€á€ºá€á€†á€­á€á€º á€†á€€á€ºá€œá€€á€ºá€›á€¾á€­á€”á€±á€•á€«á€á€šá€ºá‹"
                }
            }
            
                        
        ],
        choices: [
            { text: { en: "Continue", mm: "á€›á€¾á€±á€·á€†á€€á€ºá€™á€Šá€º" }, next: 'alarm' },
        ]
        },
        
        'alarm': {
            bg: 'home_tayza',
            world: 'real',
            location: { en: 'Home - Bedroom', mm: 'á€¡á€­á€™á€º - á€¡á€­á€•á€ºá€á€”á€ºá€¸' },
            time: '07:01 AM',
            steps: [
            {
                bg: 'home_tayza',
                audio: 'morning_chant',
                text: {
                    en: "...",
                    mm: "..."
                }
            },
            {
                bg: 'alarm',
                audio: { id: 'alarm', loop: true },
                text: {
                    en: "*The alarm is ringing*",
                    mm: "*á€”á€¾á€­á€¯á€¸á€…á€€á€ºá€¡á€žá€¶á€™á€¼á€Šá€ºá€žá€Šá€º*"
                }
            },
                        
        ],
        choices: [
            { text: { en: "Close the Alarm", mm: "á€”á€¾á€­á€¯á€¸á€…á€€á€ºá€•á€­á€á€ºá€™á€Šá€º" }, next: 'intro-tayza' },
        ]
        },

        'intro-tayza': {
            bg: 'sleep_tayza',
            world: 'real',
            location: { en: 'Home - Bedroom', mm: 'á€¡á€­á€™á€º - á€¡á€­á€•á€ºá€á€”á€ºá€¸' },
            time: '07:01 AM',
            steps: [
            {
                bg: 'sleep_tayza',
                audio: { id: 'yawn', loop: false },
                unlock: ['home'],
                text: {
                    en: "Wahhhhh...",
                    mm: "á€á€«á€¸á€¸á€¸á€¸á€¸á€¸á€¸á€¸"
                }
            },
                        
        ],
        choices: [
            { text: { en: "Sleep for a while", mm: "á€á€á€œá€±á€¬á€€á€º á€•á€¼á€”á€ºá€¡á€­á€•á€ºá€œá€­á€¯á€€á€ºá€™á€šá€º" }, next: 'alarm' },
            { text: { en: "Wake up", mm: "á€¡á€­á€•á€ºá€›á€¬á€‘á€™á€Šá€º" }, next: 'wakeup-tayza' },
        ]
        },

        'wakeup-tayza': {
            bg: 'wakeup_tayza',
            world: 'real',
            location: { en: 'Home - Bedroom', mm: 'á€¡á€­á€™á€º - á€¡á€­á€•á€ºá€á€”á€ºá€¸' },
            time: '07:05 AM',
            steps: [
            {
                bg: 'wakeup_tayza',
                audio: { id: 'oldfan', loop: true },
                speaker: SPEAKERS.unknown, text: {en: "Another morning.", mm: "á€”á€±á€¬á€€á€ºá€‘á€•á€º á€™á€”á€€á€ºá€á€„á€ºá€¸á€á€…á€ºá€á€¯..."}
            },
            {
                bg: 'oldfan',
                speaker: SPEAKERS.unknown, text: {en: "The fan spins lazily overhead, counting seconds I don't have.", mm: "á€•á€”á€ºá€€á€¬á€€ á€á€±á€«á€„á€ºá€¸á€•á€±á€«á€ºá€™á€¾á€¬á€–á€¼á€±á€¸á€Šá€¾á€„á€ºá€¸á€…á€½á€¬ á€œá€Šá€ºá€•á€á€ºá€›á€„á€ºá€¸ á€€á€»á€½á€”á€ºá€á€±á€¬á€·á€ºá€€á€á€±á€¬á€· á€€á€¯á€”á€ºá€†á€¯á€¶á€¸á€žá€½á€¬á€¸á€á€²á€· á€¡á€á€»á€­á€”á€ºá€á€½á€±á€€á€­á€¯ á€›á€±á€á€½á€€á€ºá€”á€±á€™á€­á€á€šá€ºá‹"}
            },
            {
                speaker: SPEAKERS.unknown, text: {en: "The sun is already burning through the curtains. I hate the heat.", mm: "á€”á€±á€›á€±á€¬á€„á€ºá€€ á€œá€­á€¯á€€á€ºá€€á€¬á€á€½á€±á€€á€­á€¯ á€–á€±á€¬á€€á€ºá€•á€¼á€®á€¸ á€•á€°á€œá€±á€¬á€„á€ºá€”á€±á€•á€¼á€®á‹ á€’á€®á€¡á€•á€°á€’á€á€ºá€€á€­á€¯ á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€™á€¯á€”á€ºá€¸á€á€šá€ºá‹"},
            },
                        
        ],
        choices: [
            { text: { en: "Check the phone", mm: "á€–á€¯á€”á€ºá€¸á€€á€¼á€Šá€ºá€·á€™á€šá€º" }, next: 'missedcall' },
        ]
        },

        'missedcall': {
            bg: 'missedcall',
            world: 'real',
            location: { en: 'Home - Bedroom', mm: 'á€¡á€­á€™á€º - á€¡á€­á€•á€ºá€á€”á€ºá€¸' },
            time: '07:05 AM',
            steps: [
            {
                bg: 'missedcall',
                currency: 5000,
                speaker: SPEAKERS.unknown, text: {en: "I check my phone. 14 missed calls from 'Mom'. She is in the kitchen downstairs. This is how our house works.", mm: "á€–á€¯á€”á€ºá€¸á€€á€­á€¯ á€…á€…á€ºá€€á€¼á€Šá€·á€ºá€œá€­á€¯á€€á€ºá€á€šá€ºá‹ á€¡á€™á€±á€†á€®á€€ Missed Call áá„ á€á€¯á‹ á€¡á€™á€±á€€ á€¡á€­á€™á€ºá€¡á€±á€¬á€€á€ºá€‘á€•á€º á€™á€®á€¸á€–á€­á€¯á€á€»á€±á€¬á€„á€ºá€™á€¾á€¬ á€›á€¾á€­á€”á€±á€á€¬á€€á€­á€¯á€á€±á€¬á€„á€º á€–á€¯á€”á€ºá€¸á€†á€€á€ºá€”á€±á€á€¯á€”á€ºá€¸á€•á€²á‹"},
            },
            {
                speaker: SPEAKERS.unknown, text: {en: "The pressure starts before I even leave the bed.", mm: "á€¡á€­á€•á€ºá€›á€¬á€™á€‘á€á€„á€ºá€€á€á€Šá€ºá€¸á€€ á€–á€­á€¡á€¬á€¸á€á€½á€±á€€ á€…á€á€„á€ºá€”á€±á€•á€¼á€®á‹"},
            },
            {
                speaker: SPEAKERS.tayza, text: {en: "My name is Tayza, I am 21 years old and an IT student at Info Myanmar University in Yangon, currently preparing for my upcoming final exam while trying my best to make my family proud.", mm: "á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€·á€”á€¬á€™á€Šá€º 'á€á€±á€‡' á€•á€«áŠ á€¡á€žá€€á€ºá€€á€á€±á€¬á€· á‚á á€”á€¾á€…á€ºá€•á€¼á€Šá€ºá€·á€•á€¼á€®á€¸ á€œá€€á€ºá€›á€¾á€­á€™á€¾á€¬á€á€±á€¬á€· á€›á€”á€ºá€€á€¯á€”á€ºá€™á€¼á€­á€¯á€·á€›á€¾á€­ Info Myanmar University á€™á€¾ IT á€€á€»á€±á€¬á€„á€ºá€¸á€žá€¬á€¸á€á€…á€ºá€šá€±á€¬á€€á€ºá€–á€¼á€…á€ºá€€á€¬ á€œá€¬á€™á€Šá€·á€º á€”á€±á€¬á€€á€ºá€†á€¯á€¶á€¸á€…á€¬á€™á€±á€¸á€•á€½á€²á€¡á€á€½á€€á€º á€€á€¼á€­á€¯á€¸á€…á€¬á€¸á€œá€±á€·á€œá€¬á€›á€„á€ºá€¸ á€™á€­á€žá€¬á€¸á€…á€¯á€€á€­á€¯ á€‚á€¯á€á€ºá€šá€°á€…á€±á€á€»á€„á€ºá€”á€±á€žá€°á€á€…á€ºá€šá€±á€¬á€€á€ºá€–á€¼á€…á€ºá€•á€«á€á€šá€ºá‹"},
            },
                        
        ],
        choices: [
            { text: { en: "Rush downstairs", mm: "á€¡á€±á€¬á€€á€ºá€‘á€•á€ºá€€á€­á€¯ á€¡á€™á€¼á€”á€ºá€†á€„á€ºá€¸á€™á€šá€º" }, next: 'kitchen' },
            { text: { en: "Stay in bed for 5 more minutes.", mm: "á… á€™á€­á€”á€…á€ºá€œá€±á€¬á€€á€º á€†á€€á€ºá€œá€¾á€²á€”á€±á€™á€šá€º" }, next: 'alarm' },
        ]
        },

        'kitchen': {
            bg: 'stair',
            world: 'real',
            location: { en: 'Home - Living Room', mm: 'á€¡á€­á€™á€º - á€§á€Šá€ºá€·á€á€”á€ºá€¸'},
            time: '07:15 AM',
            steps: [
            {
                bg: 'stair',
                audio: 'stair',
                text: {en: "*foot steps*", mm: "*á€á€¼á€±á€žá€¶*"},
            },
            {
                bg: 'livingroom',
                audio: 'kitchen',
                speaker: SPEAKERS.tayza, text: {en: "Mom, I'm awake.", mm: "á€¡á€™á€±..á€žá€¬á€¸á€”á€­á€¯á€¸á€•á€«á€•á€¼á€®á‹"},
            },
            {
                bg: 'livingroom',
                speaker: SPEAKERS.unknown, text: {en: "Tayza! Why are you late? Do you want to be late for school?", mm: "á€á€±á€‡.. á€žá€¬á€¸á€„á€šá€ºá€œá€±á€¸.. á€˜á€¬á€œá€­á€¯á€· á€”á€±á€¬á€€á€ºá€€á€»á€”á€±á€á€¬á€œá€²á‹ á€€á€»á€±á€¬á€„á€ºá€¸á€”á€±á€¬á€€á€ºá€€á€»á€á€»á€„á€ºá€”á€±á€á€¬á€œá€¬á€¸á‹"},
            },
            {
                speaker: SPEAKERS.tayza, text: {en: "I was studying late last night, Mom.", mm: "á€Šá€€ á€…á€¬á€€á€¼á€Šá€·á€ºá€á€¬ á€”á€±á€¬á€€á€ºá€€á€»á€žá€½á€¬á€¸á€œá€­á€¯á€·á€•á€« á€¡á€™á€±á‹"},
            },
            {

                bg: 'kitchen',
                speaker: SPEAKERS.tayza, text: {en: "Soâ€¦ this is my mother, Daw Mya Thandar. Sheâ€™s 55, works at an office, and somehow still finds the energy to take care of all of us. She doesnâ€™t say much about her worriesâ€¦ but I know she prays for me every single day. Even when I act like I donâ€™t notice.", mm: "á€’á€«á€€á€á€±á€¬á€· á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€·á€¡á€™á€± á€’á€±á€«á€ºá€™á€¼á€žá€”á€¹á€á€¬á€•á€«á‹ á€¡á€žá€€á€º á…á… á€”á€¾á€…á€ºá€›á€¾á€­á€•á€¼á€®á€¸ á€›á€¯á€¶á€¸á€™á€¾á€¬ á€¡á€œá€¯á€•á€ºá€œá€¯á€•á€ºá€á€šá€ºá‹ á€¡á€œá€¯á€•á€ºá€•á€„á€ºá€•á€”á€ºá€¸á€•á€±á€™á€šá€·á€º á€™á€­á€žá€¬á€¸á€…á€¯á€€á€­á€¯ á€‚á€¯á€á€ºá€šá€°á€…á€±á€á€»á€„á€ºá€”á€±á€žá€°á€á€…á€ºá€šá€±á€¬á€€á€ºá€–á€¼á€…á€ºá€•á€«á€á€šá€ºá‹ á€žá€°á€™á€€ á€…á€­á€¯á€¸á€›á€­á€™á€ºá€™á€¾á€¯á€á€½á€±á€€á€­á€¯ á€™á€•á€¼á€±á€¬á€á€á€ºá€˜á€°á€¸â€¦ á€’á€«á€•á€±á€™á€šá€·á€º á€”á€±á€·á€á€­á€¯á€„á€ºá€¸ á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€¡á€á€½á€€á€º á€†á€¯á€á€±á€¬á€„á€ºá€¸á€•á€±á€¸á€”á€±á€á€¬á€€á€­á€¯ á€€á€»á€½á€”á€ºá€á€±á€¬á€º á€žá€­á€•á€«á€á€šá€ºá‹ á€™á€žá€­á€žá€œá€­á€¯á€œá€¯á€•á€ºá€”á€±á€•á€±á€™á€šá€·á€ºá€œá€Šá€ºá€¸â€¦"},
            },
            {
                speaker: SPEAKERS.mom, text: {en: "After taking care of your skin, face, and teeth, have breakfast, Tayza. You're ready to eat.", mm: "á€žá€¬á€¸..á€á€±á€‡ ..á€™á€»á€€á€ºá€”á€¾á€¬á€žá€…á€ºá€žá€½á€¬á€¸á€á€­á€¯á€€á€ºá€•á€¼á€®á€¸ á€™á€”á€€á€ºá€…á€¬ á€œá€¬á€…á€¬á€¸á€á€±á€¬á€·.. á€…á€¬á€¸á€œá€­á€¯á€·á€›á€•á€¼á€®á‹"},
            },
                        
        ],
        choices: [
            { text: { en: "Wash Up & Eat Breakfast", mm: "á€™á€»á€€á€ºá€”á€¾á€¬á€žá€…á€ºá€žá€½á€¬á€¸á€á€­á€¯á€€á€ºá€•á€¼á€®á€¸ á€™á€”á€€á€ºá€…á€¬á€…á€¬á€¸á€™á€šá€º" }, next: 'washup' },
            { text: { en: "Sit at Table for a Bit", mm: "á€§á€Šá€ºá€·á€á€”á€ºá€¸á€™á€¾á€¬á€á€”á€‘á€­á€¯á€„á€ºá€™á€šá€º" }, next: 'sit_livingroom' },
        ]
        },

        'washup': {
            bg: 'bathroom',
            world: 'real',
            location: { en: 'Home - Bathroom', mm: 'á€¡á€­á€™á€º - á€›á€±á€á€»á€­á€¯á€¸á€á€”á€ºá€¸' },
            time: '07:20 AM',
            audio: 'water_splash',
            steps: [
                {
                    bg: 'bathroom',
                    speaker: SPEAKERS.tayza,
                    text: { en: "Cold water hits my face. I look at the mirror. Dark circles. Tired eyes.", mm: "á€›á€±á€¡á€±á€¸á€¡á€±á€¸á€€ á€™á€»á€€á€ºá€”á€¾á€¬á€•á€±á€«á€ºá€€á€»á€œá€¬á€á€šá€ºá‹ á€™á€¾á€”á€ºá€‘á€²á€€á€¼á€Šá€·á€ºá€œá€­á€¯á€€á€ºá€á€±á€¬á€· á€™á€»á€€á€ºá€€á€½á€„á€ºá€¸á€Šá€­á€¯á€á€½á€±á€”á€²á€· á€•á€„á€ºá€•á€”á€ºá€¸á€”á€±á€á€²á€· á€™á€»á€€á€ºá€œá€¯á€¶á€¸á€á€½á€±á‹" }
                },
                {
                    speaker: SPEAKERS.bro,
                    text: { en: "Yo, Tayza. Not done yet?", mm: "á€Ÿá€±á€·á€›á€±á€¬á€„á€º á€á€±á€‡á‹ á€™á€•á€¼á€®á€¸á€žá€±á€¸á€˜á€°á€¸á€œá€¬á€¸á€€á€½á€¬á‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "This is my older brother, Ko Thiha. He's a pilot. Or at least, he's training to be one. He's the golden child.", mm: "á€’á€«á€€ á€€á€»á€½á€”á€ºá€á€±á€¬á€·á€ºá€¡á€…á€ºá€€á€­á€¯áŠ á€€á€­á€¯á€žá€®á€Ÿá‹ á€žá€°á€€ á€œá€±á€šá€¬á€‰á€ºá€™á€¾á€°á€¸á€á€…á€ºá€šá€±á€¬á€€á€ºá‹ á€’á€«á€™á€¾á€™á€Ÿá€¯á€á€º á€œá€±á€šá€¬á€‰á€ºá€™á€¾á€°á€¸á€žá€„á€ºá€á€”á€ºá€¸á€á€€á€ºá€”á€±á€á€¬á€•á€±á€«á€·á‹ á€¡á€­á€™á€ºá€›á€²á€· á€›á€½á€¾á€±á€žá€¬á€¸á€œá€±á€¸á€•á€±á€«á€·á‹" }
                },
                {
                    speaker: SPEAKERS.bro,
                    text: { en: "Whoa, look at you. You look like a panda, bro. What have you been doing? Gaming all night?", mm: "á€Ÿá€¬... á€™á€„á€ºá€¸á€•á€¯á€¶á€…á€¶á€€á€¼á€Šá€·á€ºá€•á€«á€¦á€¸á‹ á€•á€”á€ºá€’á€«á€›á€¯á€•á€ºá€•á€±á€«á€€á€ºá€”á€±á€•á€¼á€® á€Šá€®á€œá€±á€¸á€›á€¬á‹ á€˜á€¬á€á€½á€±á€œá€¯á€•á€ºá€”á€±á€á€¬á€œá€²á‹ á€á€Šá€œá€¯á€¶á€¸ á€‚á€­á€™á€ºá€¸á€†á€±á€¬á€·á€”á€±á€á€¬á€œá€¬á€¸á‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "No, Ko Gyi. I'm preparing for the final exam. The pressure is real.", mm: "á€™á€Ÿá€¯á€á€ºá€•á€«á€˜á€°á€¸ á€€á€­á€¯á€€á€¼á€®á€¸á€›á€¬á‹ á€…á€¬á€™á€±á€¸á€•á€½á€²á€¡á€á€½á€€á€º á€…á€¬á€€á€¼á€Šá€·á€ºá€”á€±á€á€¬á€•á€«á‹ á€–á€­á€¡á€¬á€¸á€á€½á€±á€€ á€á€€á€šá€ºá€™á€»á€¬á€¸á€á€šá€ºá‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "Ko Gyi, how did you get through your pilot training exams? Any tips?", mm: "á€€á€­á€¯á€€á€¼á€®á€¸... á€œá€±á€šá€¬á€‰á€ºá€™á€¾á€°á€¸á€…á€¬á€™á€±á€¸á€•á€½á€²á€á€¯á€”á€ºá€¸á€€ á€˜á€šá€ºá€œá€­á€¯á€–á€¼á€±á€á€²á€·á€œá€²á‹ á€¡á€€á€¼á€¶á€‰á€¬á€á€ºá€œá€±á€¸ á€˜á€¬á€œá€±á€¸á€™á€›á€¾á€­á€˜á€°á€¸á€œá€¬á€¸á‹" }
                },
                {
                    speaker: SPEAKERS.bro,
                    text: { en: "Ah, exams. Just focus on the process, not the result. And sleep, kid. You can't fly if you're asleep at the wheel.", mm: "á€¡á€±á€¬á€º á€…á€¬á€™á€±á€¸á€•á€½á€²á€œá€¬á€¸á‹ á€›á€œá€’á€ºá€€á€­á€¯á€™á€€á€¼á€Šá€·á€ºá€”á€²á€· á€œá€¯á€•á€ºá€„á€”á€ºá€¸á€…á€‰á€ºá€€á€­á€¯á€¡á€¬á€›á€¯á€¶á€…á€­á€¯á€€á€ºá‹ á€•á€¼á€®á€¸á€á€±á€¬á€· á€¡á€­á€•á€ºá€›á€±á€¸á€á€á€¡á€­á€•á€ºá‹ á€™á€„á€ºá€¸á€¡á€­á€•á€ºá€„á€­á€¯á€€á€ºá€”á€±á€›á€„á€º á€œá€±á€šá€¬á€‰á€ºá€™á€±á€¬á€„á€ºá€¸á€œá€­á€¯á€·á€™á€›á€˜á€°á€¸á‹" }
                },
                {
                    speaker: SPEAKERS.bro,
                    text: { en: "Here, take this. Buy some snacks or coffee. Good luck.", mm: "á€›á€±á€¬á€·... á€’á€«á€šá€°á€žá€½á€¬á€¸á‹ á€™á€¯á€”á€·á€ºá€•á€²á€–á€¼á€…á€ºá€–á€¼á€…á€º á€€á€±á€¬á€ºá€–á€®á€•á€²á€–á€¼á€…á€ºá€–á€¼á€…á€º á€á€šá€ºá€žá€±á€¬á€€á€ºá€œá€­á€¯á€€á€ºá‹ á€€á€¶á€€á€±á€¬á€„á€ºá€¸á€•á€«á€…á€±á€€á€½á€¬á‹" },
                    currency: 5000
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "Thanks, Ko Gyi.", mm: "á€€á€»á€±á€¸á€‡á€°á€¸á€•á€« á€€á€­á€¯á€€á€¼á€®á€¸á‹" }
                }
            ],
            choices: [
                { text: { en: "Go to breakfast", mm: "á€™á€”á€€á€ºá€…á€¬á€…á€¬á€¸á€›á€”á€ºá€žá€½á€¬á€¸á€™á€Šá€º" }, next: 'breakfast_table' }
            ]
        },

        'sit_livingroom': {
            bg: 'livingroom',
            world: 'real',
            location: { en: 'Home - Living Room', mm: 'á€¡á€­á€™á€º - á€§á€Šá€ºá€·á€á€”á€ºá€¸' },
            time: '07:20 AM',
            steps: [
                {
                    bg: 'livingroom',
                    speaker: SPEAKERS.tayza,
                    text: { en: "I sit on the sofa for a moment, letting the fan cool me down.", mm: "á€†á€­á€¯á€–á€¬á€•á€±á€«á€ºá€™á€¾á€¬ á€á€á€‘á€­á€¯á€„á€ºá€œá€­á€¯á€€á€ºá€•á€¼á€®á€¸ á€•á€”á€ºá€€á€¬á€œá€±á€€á€­á€¯ á€á€¶á€…á€¬á€¸á€”á€±á€œá€­á€¯á€€á€ºá€á€šá€ºá‹" }
                },
                {
                    speaker: SPEAKERS.bro,
                    text: { en: "Hey, Lazy-za. What are you doing? I'm done cleaning up. Gonna grab breakfast.", mm: "á€Ÿá€±á€·á€€á€±á€¬á€„á€º á€•á€»á€„á€ºá€¸á€á€±á€‡á‹ á€˜á€¬á€œá€¯á€•á€ºá€”á€±á€á€¬á€œá€²á‹ á€„á€«á€á€±á€¬á€· á€›á€±á€á€»á€­á€¯á€¸á€•á€¼á€®á€¸á€•á€¼á€®á‹ á€™á€”á€€á€ºá€…á€¬á€žá€½á€¬á€¸á€…á€¬á€¸á€á€±á€¬á€·á€™á€šá€ºá‹" }
                },
                {
                    speaker: SPEAKERS.bro,
                    text: { en: "Mom's gonna yell if you're late for school.", mm: "á€€á€»á€±á€¬á€„á€ºá€¸á€”á€±á€¬á€€á€ºá€€á€»á€›á€„á€º á€¡á€™á€±á€†á€°á€œá€­á€™á€·á€ºá€™á€šá€ºá€”á€±á€¬á€ºá‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "Yeah, yeah. I'm coming.", mm: "á€¡á€±á€¸á€•á€«... á€œá€¬á€•á€«á€•á€¼á€®á‹" }
                }
            ],
            choices: [
                { text: { en: "Go to kitchen", mm: "á€™á€®á€¸á€–á€­á€¯á€á€»á€±á€¬á€„á€ºá€žá€­á€¯á€·á€žá€½á€¬á€¸á€™á€Šá€º" }, next: 'breakfast_table' }
            ]
        },

        'breakfast_table': {
            bg: 'dining_room',
            world: 'real',
            location: { en: 'Home - Dining Room', mm: 'á€¡á€­á€™á€º - á€‘á€™á€„á€ºá€¸á€…á€¬á€¸á€á€”á€ºá€¸' },
            time: '07:30 AM',
            steps: [
                {
                    bg: 'dining_room',
                    audio: 'kitchen',
                    speaker: SPEAKERS.mom,
                    text: { en: "Eat quickly. Mohinga is getting cold.", mm: "á€™á€¼á€”á€ºá€™á€¼á€”á€ºá€…á€¬á€¸á‹ á€™á€¯á€”á€·á€ºá€Ÿá€„á€ºá€¸á€á€«á€¸ á€¡á€±á€¸á€€á€¯á€”á€ºá€á€±á€¬á€·á€™á€šá€ºá‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "I eat quickly. The taste of fish soup wakes me up better than coffee.", mm: "á€€á€»á€½á€”á€ºá€á€±á€¬á€º á€™á€¼á€”á€ºá€™á€¼á€”á€ºá€…á€¬á€¸á€œá€­á€¯á€€á€ºá€á€šá€ºá‹ á€„á€«á€¸á€Ÿá€„á€ºá€¸á€›á€Šá€ºá€¡á€›á€žá€¬á€€ á€€á€±á€¬á€ºá€–á€®á€‘á€€á€ºá€á€±á€¬á€„á€º á€•á€­á€¯á€•á€¼á€®á€¸á€œá€”á€ºá€¸á€†á€”á€ºá€¸á€…á€±á€á€šá€ºá‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "I'm leaving for school now, Mom!", mm: "á€¡á€™á€±... á€žá€¬á€¸á€€á€»á€±á€¬á€„á€ºá€¸á€žá€½á€¬á€¸á€á€±á€¬á€·á€™á€šá€ºá‹" }
                }
            ],
            choices: [
                { text: { en: "Go to School / Shwedagon", mm: "á€€á€»á€±á€¬á€„á€ºá€¸/á€˜á€¯á€›á€¬á€¸ á€žá€½á€¬á€¸á€™á€Šá€º" }, next: 'street_monk' }
            ]
        },

        'street_monk': {
            bg: 'downtown',
            world: 'real',
            location: { en: 'Yangon - Streets', mm: 'á€›á€”á€ºá€€á€¯á€”á€º - á€œá€™á€ºá€¸á€™á€•á€±á€«á€º' },
            time: '08:00 AM',
            steps: [
                {
                    bg: 'downtown',
                    audio: 'city_ambience',
                    speaker: SPEAKERS.tayza,
                    text: { en: "I decide to stop by Shwedagon Pagoda before class. I need some peace of mind for the exam.", mm: "á€¡á€á€”á€ºá€¸á€™á€žá€½á€¬á€¸á€á€„á€º á€›á€½á€¾á€±á€á€­á€‚á€¯á€¶á€˜á€¯á€›á€¬á€¸á€€á€­á€¯ á€á€á€á€„á€ºá€–á€­á€¯á€· á€†á€¯á€¶á€¸á€–á€¼á€á€ºá€œá€­á€¯á€€á€ºá€á€šá€ºá‹ á€…á€¬á€™á€±á€¸á€•á€½á€²á€¡á€á€½á€€á€º á€…á€­á€á€ºá€„á€¼á€­á€™á€ºá€žá€€á€ºá€™á€¾á€¯ á€œá€­á€¯á€¡á€•á€ºá€”á€±á€á€šá€ºá‹" }
                },
                {
                    speaker: SPEAKERS.monk,
                    text: { en: "Young man...", mm: "á€œá€°á€œá€±á€¸..." }
                },
                {
                    bg: 'downtown', 
                    char: 'monk',
                    speaker: SPEAKERS.monk,
                    text: { en: "The shadow follows the object, but sometimes... the shadow moves on its own.", mm: "á€¡á€›á€­á€•á€ºá€†á€­á€¯á€á€¬ á€á€á€¹á€‘á€¯á€•á€…á€¹á€…á€Šá€ºá€¸á€”á€±á€¬á€€á€ºá€€á€­á€¯á€œá€­á€¯á€€á€ºá€á€šá€º... á€’á€«á€•á€±á€™á€šá€·á€º á€á€…á€ºá€á€«á€á€…á€ºá€œá€±á€€á€»á€›á€„á€º á€¡á€›á€­á€•á€ºá€€ á€žá€°á€·á€˜á€¬á€žá€¬ á€›á€½á€±á€·á€œá€»á€¬á€¸á€á€á€ºá€á€šá€ºá‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "Uh... sure, Sayadaw. (What was that about?)", mm: "á€á€„á€ºá€•á€«á€·á€˜á€¯á€›á€¬á€¸... (á€˜á€¬á€€á€­á€¯á€†á€­á€¯á€œá€­á€¯á€á€¬á€•á€«á€œá€­á€™á€·á€º...)" }
                }
            ],
            choices: [
                { text: { en: "Go to Shwedagon Pagoda", mm: "á€›á€½á€¾á€±á€á€­á€‚á€¯á€¶á€˜á€¯á€›á€¬á€¸á€žá€­á€¯á€·á€žá€½á€¬á€¸á€™á€Šá€º" }, next: 'shwedagon_arrival' }
            ]
        },

        'shwedagon_arrival': {
            bg: 'shwedagon_stairs',
            world: 'real',
            location: { en: 'Shwedagon Pagoda', mm: 'á€›á€½á€¾á€±á€á€­á€‚á€¯á€¶á€˜á€¯á€›á€¬á€¸' },
            time: '08:30 AM',
            audio: 'pagoda_bells',
            unlock: ['shwedagon'],
            steps: [
                {
                    bg: 'shwedagon_stairs',
                    clearChar: true,
                    text: { en: "The southern stairway. Cool tiles under my feet. The smell of flowers and incense.", mm: "á€á€±á€¬á€„á€ºá€˜á€€á€ºá€™á€¯á€á€ºá€…á€±á€¬á€„á€ºá€¸á€á€”á€ºá€¸á‹ á€á€¼á€±á€–á€á€«á€¸á€¡á€±á€¬á€€á€ºá€€ á€¡á€±á€¸á€™á€¼á€á€²á€· á€€á€»á€±á€¬á€€á€ºá€•á€¼á€¬á€¸á€á€½á€±á‹ á€•á€”á€ºá€¸á€”á€¶á€·á€”á€²á€· á€¡á€™á€½á€¾á€±á€¸á€á€­á€¯á€„á€ºá€”á€¶á€·á€á€½á€±á‹" }
                },
                {
                    bg: 'shwedagon',
                    text: { en: "The Great Pagoda towers above, a mountain of gold against the blue sky.", mm: "á€›á€½á€¾á€±á€á€­á€‚á€¯á€¶á€…á€±á€á€®á€á€±á€¬á€ºá€™á€¼á€á€ºá€€á€¼á€®á€¸á€€ á€™á€­á€¯á€¸á€•á€¼á€¬á€›á€±á€¬á€„á€ºá€€á€±á€¬á€„á€ºá€¸á€€á€„á€ºá€¡á€±á€¬á€€á€ºá€™á€¾á€¬ á€›á€½á€¾á€±á€á€±á€¬á€„á€ºá€€á€¼á€®á€¸á€á€…á€ºá€á€¯á€œá€­á€¯ á€á€Šá€ºá€›á€¾á€­á€”á€±á€á€šá€ºá‹" }
                }
            ],
            choices: [
                { text: { en: "Find a corner to pray", mm: "á€†á€¯á€á€±á€¬á€„á€ºá€¸á€›á€”á€ºá€”á€±á€›á€¬á€›á€¾á€¬á€™á€Šá€º" }, next: 'shwedagon_pray' }
            ]
        },

        'shwedagon_pray': {
            bg: 'shwedagon',
            world: 'real',
            location: { en: 'Tuesday Corner', mm: 'á€¡á€„á€ºá€¹á€‚á€«á€‘á€±á€¬á€„á€·á€º' },
            time: '08:45 AM',
            steps: [
                {
                    text: { en: "I kneel at the Tuesday corner. 'Please let me pass the exam. Please let me make my parents proud.'", mm: "á€¡á€„á€ºá€¹á€‚á€«á€‘á€±á€¬á€„á€·á€ºá€™á€¾á€¬ á€’á€°á€¸á€‘á€±á€¬á€€á€ºá€œá€­á€¯á€€á€ºá€á€šá€ºá‹ 'á€…á€¬á€™á€±á€¸á€•á€½á€²á€¡á€±á€¬á€„á€ºá€•á€«á€…á€±á‹ á€™á€­á€˜á€á€½á€±á€€á€­á€¯ á€‚á€¯á€á€ºá€šá€°á€á€„á€·á€ºá€€á€¼á€½á€¬á€¸á€”á€­á€¯á€„á€ºá€žá€° á€–á€¼á€…á€ºá€•á€«á€…á€±á€žá€¬á€¸'á‹" }
                },
                {
                    text: { en: "I close my eyes, chanting silently.", mm: "á€™á€»á€€á€ºá€œá€¯á€¶á€¸á€á€½á€±á€€á€­á€¯ á€™á€¾á€­á€á€ºá€•á€¼á€®á€¸ á€á€­á€á€ºá€á€†á€­á€á€º á€‚á€¯á€á€ºá€á€±á€¬á€ºá€•á€½á€¬á€¸á€”á€±á€œá€­á€¯á€€á€ºá€á€šá€ºá‹" }
                },
                {
                    audio: { id: 'ring_drop', loop: false }, /* Assuming audio fallback works */
                    text: { en: "*CLINK*", mm: "*á€á€œá€½á€™á€º*" }
                },
                {
                    text: { en: "Ouch! Something hit my head!", mm: "á€¡á€¬á€¸! á€á€±á€«á€„á€ºá€¸á€€á€­á€¯ á€á€…á€ºá€á€¯á€á€¯ á€œá€¬á€™á€¾á€”á€ºá€á€šá€ºá‹" }
                },
                {
                    text: { en: "I look around. Did it fall from the roof?", mm: "á€˜á€±á€¸á€˜á€®á€€á€­á€¯ á€€á€¼á€Šá€·á€ºá€œá€­á€¯á€€á€ºá€á€šá€ºá‹ á€á€±á€«á€„á€ºá€™á€­á€¯á€¸á€•á€±á€«á€ºá€€ á€•á€¼á€¯á€á€ºá€€á€»á€œá€¬á€á€¬á€œá€¬á€¸á‹" }
                }
            ],
            choices: [
                { text: { en: "Look at the object", mm: "á€˜á€¬á€œá€²á€†á€­á€¯á€á€¬ á€€á€¼á€Šá€·á€ºá€œá€­á€¯á€€á€ºá€™á€Šá€º" }, next: 'ring_incident' }
            ]
        },

        'ring_incident': {
            bg: 'ring_item',
            world: 'real',
            location: { en: 'Tuesday Corner', mm: 'á€¡á€„á€ºá€¹á€‚á€«á€‘á€±á€¬á€„á€·á€º' },
            time: '08:46 AM',
            steps: [
                {
                    bg: 'ring_item',
                    text: { en: "It's a ring. An old, silver ring with strange engravings. It doesn't look like jewelry someone would just drop.", mm: "á€œá€€á€ºá€…á€½á€•á€ºá€á€…á€ºá€€á€½á€„á€ºá€¸á€•á€²á‹ á€‘á€°á€¸á€†á€”á€ºá€¸á€á€²á€· á€¡á€€á€¹á€á€›á€¬á€á€½á€±á€”á€²á€· á€›á€¾á€±á€¸á€Ÿá€±á€¬á€„á€ºá€¸á€„á€½á€±á€œá€€á€ºá€…á€½á€•á€ºá€á€…á€ºá€€á€½á€„á€ºá€¸á‹ á€œá€½á€šá€ºá€œá€½á€šá€ºá€€á€°á€€á€° á€•á€¼á€¯á€á€ºá€€á€»á€á€²á€·á€™á€šá€·á€º á€œá€€á€ºá€á€á€ºá€›á€á€”á€¬á€™á€»á€­á€¯á€¸á€”á€²á€· á€™á€á€°á€˜á€°á€¸á‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "Weird. Should I leave it here?", mm: "á€‘á€°á€¸á€†á€”á€ºá€¸á€á€šá€ºá‹ á€’á€®á€¡á€á€­á€¯á€„á€ºá€¸ á€‘á€¬á€¸á€á€²á€·á€žá€„á€·á€ºá€œá€¬á€¸á‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "But... it feels warm.", mm: "á€’á€«á€•á€±á€™á€šá€·á€º... á€€á€­á€¯á€„á€ºá€€á€¼á€Šá€·á€ºá€›á€á€¬ á€”á€½á€±á€¸á€”á€±á€á€šá€ºá‹" }
                }
            ],
            choices: [
                { text: { en: "Keep it in backpack", mm: "á€œá€½á€šá€ºá€¡á€­á€á€ºá€‘á€² á€‘á€Šá€·á€ºá€žá€­á€™á€ºá€¸á€‘á€¬á€¸á€™á€Šá€º" }, next: 'keep_ring' },
                { text: { en: "Leave it (Force Pick up)", mm: "á€‘á€¬á€¸á€á€²á€·á€™á€Šá€º (á€™á€›á€•á€«)" }, next: 'keep_ring' } // Forcing narrative for now
            ]
        },

        'keep_ring': {
            bg: 'shwedagon',
            world: 'real',
            location: { en: 'Shwedagon Pagoda', mm: 'á€›á€½á€¾á€±á€á€­á€‚á€¯á€¶á€˜á€¯á€›á€¬á€¸' },
            time: '09:00 AM',
            steps: [
                {
                    text: { en: "I decided to keep it safe for now. Maybe I can find the owner later.", mm: "á€œá€±á€¬á€œá€±á€¬á€†á€šá€ºá€á€±á€¬á€· á€œá€¯á€¶á€á€¼á€¯á€¶á€¡á€±á€¬á€„á€º á€žá€­á€™á€ºá€¸á€‘á€¬á€¸á€œá€­á€¯á€€á€ºá€™á€šá€ºá‹ á€”á€±á€¬á€€á€ºá€™á€¾ á€•á€­á€¯á€„á€ºá€›á€¾á€„á€ºá€›á€¾á€¬á€•á€±á€¸á€á€±á€¬á€·á€™á€šá€ºá‹" }
                },
                {
                    text: { en: "I leave the pagoda. The city is waiting.", mm: "á€˜á€¯á€›á€¬á€¸á€•á€±á€«á€ºá€€ á€•á€¼á€”á€ºá€†á€„á€ºá€¸á€œá€¬á€á€²á€·á€á€šá€ºá‹ á€™á€¼á€­á€¯á€·á€€á€¼á€®á€¸á€€ á€…á€±á€¬á€„á€·á€ºá€€á€¼á€­á€¯á€”á€±á€á€šá€ºá‹" }
                }
            ],
            choices: [
                { text: { en: "Go to Downtown", mm: "á€™á€¼á€­á€¯á€·á€‘á€²á€˜á€€á€º á€žá€½á€¬á€¸á€™á€Šá€º" }, next: 'downtown_walk' }
            ]
        },

        'downtown_walk': {
            bg: 'downtown',
            world: 'real',
            location: { en: 'Yangon - Downtown', mm: 'á€›á€”á€ºá€€á€¯á€”á€º - á€™á€¼á€­á€¯á€·á€‘á€²' },
            time: '05:00 PM',
            unlock: ['downtown', 'sule'],
            steps: [
                {
                    bg: 'downtown',
                    audio: 'city_ambience',
                    text: { en: "Time flies. Evening falls on Yangon.", mm: "á€¡á€á€»á€­á€”á€ºá€á€½á€± á€€á€¯á€”á€ºá€á€¬á€™á€¼á€”á€ºá€œá€­á€¯á€€á€ºá€á€¬á‹ á€›á€”á€ºá€€á€¯á€”á€ºá€™á€¾á€¬ á€Šá€”á€±á€…á€±á€¬á€„á€ºá€¸á€”á€±á€•á€¼á€®á‹" }
                },
                {
                    text: { en: "The streets are packed. People rushing home, buses honking, the smell of street food frying.", mm: "á€œá€™á€ºá€¸á€á€½á€±á€•á€±á€«á€ºá€™á€¾á€¬ á€œá€°á€á€½á€±á€•á€¼á€Šá€·á€ºá€€á€»á€•á€ºá€”á€±á€á€šá€ºá‹ á€¡á€­á€™á€ºá€•á€¼á€”á€ºá€™á€šá€·á€ºá€žá€°á€á€½á€±áŠ á€€á€¬á€¸á€Ÿá€½á€”á€ºá€¸á€žá€¶á€á€½á€±áŠ á€œá€™á€ºá€¸á€˜á€±á€¸á€¡á€…á€¬á€¸á€¡á€…á€¬ á€€á€¼á€±á€¬á€ºá€œá€¾á€±á€¬á€ºá€”á€¶á€·á€á€½á€±á‹" }
                },
                {
                    text: { en: "The Yangon River glitters in the distance. This chaos... it's beautiful in its own way.", mm: "á€›á€”á€ºá€€á€¯á€”á€ºá€™á€¼á€…á€ºá€€ á€¡á€á€±á€¸á€™á€¾á€¬ á€á€œá€€á€ºá€œá€€á€ºá€á€±á€¬á€€á€ºá€•á€”á€±á€á€šá€ºá‹ á€’á€®á€›á€¾á€¯á€•á€ºá€‘á€½á€±á€¸á€™á€¾á€¯á€á€½á€±á€€... á€žá€°á€·á€”á€Šá€ºá€¸á€žá€°á€·á€Ÿá€”á€ºá€”á€²á€·á€á€±á€¬á€· á€œá€¾á€•á€”á€±á€á€¬á€•á€«á€•á€²á‹" }
                }
            ],
            choices: [
                { text: { en: "Go Home for Dinner", mm: "á€Šá€…á€¬á€…á€¬á€¸á€›á€”á€º á€¡á€­á€™á€ºá€•á€¼á€”á€ºá€™á€Šá€º" }, next: 'dinner_scene' }
            ]
        },

        'dinner_scene': {
            bg: 'dining_room',
            world: 'real',
            location: { en: 'Home - Dining Room', mm: 'á€¡á€­á€™á€º - á€‘á€™á€„á€ºá€¸á€…á€¬á€¸á€á€”á€ºá€¸' },
            time: '07:00 PM',
            steps: [
                {
                    bg: 'dining_room',
                    speaker: SPEAKERS.mom,
                    text: { en: "Welcome back, son. Wash your hands. Dinner is ready.", mm: "á€•á€¼á€”á€ºá€›á€±á€¬á€€á€ºá€•á€¼á€®á€œá€¬á€¸ á€žá€¬á€¸á‹ á€œá€€á€ºá€†á€±á€¸á€œá€­á€¯á€€á€ºá€¦á€¸á‹ á€Šá€…á€¬á€›á€•á€¼á€®á‹" }
                },
                {
                    speaker: SPEAKERS.dad,
                    text: { en: "Tayza. How is the exam preparation?", mm: "á€á€±á€‡á‹ á€…á€¬á€™á€±á€¸á€•á€½á€²á€•á€¼á€„á€ºá€†á€„á€ºá€™á€¾á€¯ á€¡á€á€¼á€±á€¡á€”á€±á€˜á€šá€ºá€œá€­á€¯á€œá€²á‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "This is my father. Strict. Traditional. He loves us, but his expectations are heavy.", mm: "á€’á€«á€€ á€€á€»á€½á€”á€ºá€á€±á€¬á€·á€ºá€¡á€–á€±á‹ á€…á€Šá€ºá€¸á€€á€™á€ºá€¸á€€á€¼á€®á€¸á€á€šá€ºá‹ á€›á€¾á€±á€¸á€›á€­á€¯á€¸á€†á€”á€ºá€á€šá€ºá‹ á€€á€»á€½á€”á€ºá€á€±á€¬á€ºá€á€­á€¯á€·á€€á€­á€¯ á€á€»á€…á€ºá€•á€±á€™á€šá€·á€º á€žá€°á€‘á€¬á€¸á€á€²á€· á€™á€»á€¾á€±á€¬á€ºá€œá€„á€·á€ºá€á€»á€€á€ºá€á€½á€±á€€ á€œá€±á€¸á€œá€¶á€œá€½á€”á€ºá€¸á€á€šá€ºá‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "It's going well, Dad.", mm: "á€¡á€†á€„á€ºá€•á€¼á€±á€•á€«á€á€šá€º á€¡á€–á€±á‹" }
                },
                {
                    speaker: SPEAKERS.dad,
                    text: { en: "Good. Your future depends on you. Don't disappoint us.", mm: "á€€á€±á€¬á€„á€ºá€¸á€á€šá€ºá‹ á€™á€„á€ºá€¸á€›á€²á€·á€¡á€”á€¬á€‚á€á€ºá€€ á€™á€„á€ºá€¸á€¡á€•á€±á€«á€ºá€™á€¾á€¬á€•á€² á€™á€°á€á€Šá€ºá€á€šá€ºá‹ á€„á€«á€á€­á€¯á€·á€€á€­á€¯ á€…á€­á€á€ºá€™á€•á€»á€€á€ºá€…á€±á€”á€²á€·á‹" }
                },
                {
                    speaker: SPEAKERS.bro,
                    text: { en: "Yeah, he's been trying really hard... at sleeping.", mm: "á€Ÿá€¯á€á€ºá€á€šá€º á€¡á€–á€±á‹ á€žá€°á€á€±á€¬á€ºá€á€±á€¬á€º á€€á€¼á€­á€¯á€¸á€…á€¬á€¸á€”á€±á€á€¬... á€¡á€­á€•á€ºá€–á€­á€¯á€·á€œá€±á‹" }
                },
                {
                    speaker: SPEAKERS.mom,
                    text: { en: "*Taps brother's shoulder* Ko Thiha! Don't tease your little brother. Just eat.", mm: "*á€•á€á€¯á€¶á€¸á€€á€­á€¯á€•á€¯á€á€ºá€œá€»á€€á€º* á€€á€­á€¯á€žá€®á€Ÿ! á€Šá€®á€œá€±á€¸á€€á€­á€¯ á€…á€™á€”á€±á€”á€²á€·á‹ á€‘á€™á€„á€ºá€¸á€•á€²á€…á€¬á€¸á‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "I smile faintly. This is normal. This is home.", mm: "á€€á€»á€½á€”á€ºá€á€±á€¬á€º á€–á€»á€±á€¬á€·á€á€±á€¬á€·á€…á€½á€¬ á€•á€¼á€¯á€¶á€¸á€œá€­á€¯á€€á€ºá€á€šá€ºá‹ á€’á€«á€€ á€•á€¯á€¶á€™á€¾á€”á€ºá€•á€«á€•á€²á‹ á€’á€«á€€ á€¡á€­á€™á€ºá€•á€«á€•á€²á‹" }
                }
            ],
            choices: [
                { text: { en: "Go to room to study", mm: "á€¡á€á€”á€ºá€¸á€•á€¼á€”á€ºá€•á€¼á€®á€¸ á€…á€¬á€œá€¯á€•á€ºá€™á€Šá€º" }, next: 'room_night' }
            ]
        },

        'room_night': {
            bg: 'bedroom_night',
            world: 'real',
            location: { en: 'Home - Bedroom', mm: 'á€¡á€­á€™á€º - á€¡á€­á€•á€ºá€á€”á€ºá€¸' },
            time: '11:00 PM',
            audio: 'creepy_drone', /* subtle foreshadowing */
            steps: [
                {
                    bg: 'bedroom_night',
                    text: { en: "I study for hours. My eyes are heavy.", mm: "á€…á€¬á€œá€¯á€•á€ºá€”á€±á€á€¬ á€”á€¬á€›á€®á€•á€±á€«á€„á€ºá€¸á€™á€»á€¬á€¸á€…á€½á€¬ á€€á€¼á€¬á€•á€¼á€®á‹ á€™á€»á€€á€ºá€á€½á€¶á€á€½á€± á€œá€±á€¸á€œá€¶á€œá€¬á€á€šá€ºá‹" }
                },
                {
                    text: { en: "Then I remember the ring.", mm: "á€›á€¯á€á€ºá€á€›á€€á€º á€œá€€á€ºá€…á€½á€•á€ºá€€á€­á€¯ á€žá€á€­á€›á€žá€½á€¬á€¸á€á€šá€ºá‹" }
                },
                {
                    bg: 'ring_item',
                    text: { en: "I take it out of my bag. Under the desk lamp, it glows softly.", mm: "á€¡á€­á€á€ºá€‘á€²á€€á€”á€± á€‘á€¯á€á€ºá€œá€­á€¯á€€á€ºá€á€šá€ºá‹ á€™á€®á€¸á€¡á€­á€™á€ºá€¡á€œá€„á€ºá€¸á€›á€±á€¬á€„á€ºá€¡á€±á€¬á€€á€ºá€™á€¾á€¬ á€œá€€á€ºá€…á€½á€•á€ºá€€ á€™á€¾á€­á€”á€ºá€–á€»á€–á€» á€œá€„á€ºá€¸á€”á€±á€á€šá€ºá‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "Just for a second...", mm: "á€á€á€œá€±á€¸á€•á€«á€•á€²..." }
                },
                {
                    text: { en: "I slide it onto my finger. It fits perfectly.", mm: "á€œá€€á€ºá€á€»á€±á€¬á€„á€ºá€¸á€‘á€²á€€á€­á€¯ á€…á€½á€•á€ºá€‘á€Šá€·á€ºá€œá€­á€¯á€€á€ºá€á€šá€ºá‹ á€€á€½á€€á€ºá€á€­á€•á€²á‹" }
                },
                {
                    bg: 'bedroom_night',
                    text: { en: "A sudden wave of exhaustion hits me. I put my head on the desk.", mm: "á€›á€¯á€á€ºá€á€›á€€á€º á€•á€„á€ºá€•á€”á€ºá€¸á€”á€½á€™á€ºá€¸á€”á€šá€ºá€™á€¾á€¯á€á€½á€± á€á€„á€ºá€›á€±á€¬á€€á€ºá€œá€¬á€á€šá€ºá‹ á€…á€¬á€¸á€•á€½á€²á€á€¯á€¶á€•á€±á€«á€º á€á€±á€«á€„á€ºá€¸á€™á€¾á€±á€¬á€€á€ºá€á€»á€œá€­á€¯á€€á€ºá€™á€­á€á€šá€ºá‹" }
                }
            ],
            choices: [
                { text: { en: "Fall asleep", mm: "á€¡á€­á€•á€ºá€•á€»á€±á€¬á€ºá€žá€½á€¬á€¸á€žá€Šá€º" }, next: 'wakeup_parallel' }
            ]
        },

        'wakeup_parallel': {
            bg: 'parallel_sule',
            world: 'parallel',
            location: { en: '???', mm: '???' },
            time: 'UNKNOWN',
            audio: 'creepy_drone',
            steps: [
                {
                    bg: 'parallel_sule',
                    text: { en: "...", mm: "..." }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "Huh? Where...?", mm: "á€Ÿá€„á€º... á€˜á€šá€ºá€›á€±á€¬á€€á€ºá€”á€±á€á€¬á€œá€²...?" }
                },
                {
                    text: { en: "I wake up. But not at my desk. I am standing in the middle of the road. Near Sule Pagoda.", mm: "á€€á€»á€½á€”á€ºá€á€±á€¬á€º á€”á€­á€¯á€¸á€œá€¬á€á€šá€ºá‹ á€’á€«á€•á€±á€™á€šá€·á€º á€…á€¬á€¸á€•á€½á€²á€á€¯á€¶á€™á€¾á€¬ á€™á€Ÿá€¯á€á€ºá€˜á€°á€¸á‹ á€œá€™á€ºá€¸á€™á€œá€šá€ºá€á€±á€«á€„á€ºá€™á€¾á€¬ á€›á€•á€ºá€”á€±á€™á€­á€á€¬á‹ á€†á€°á€¸á€œá€±á€˜á€¯á€›á€¬á€¸á€”á€¬á€¸á€™á€¾á€¬á‹" }
                },
                {
                    text: { en: "The sky is a wrong shade of blue. The air smells like... rust.", mm: "á€€á€±á€¬á€„á€ºá€¸á€€á€„á€ºá€¡á€›á€±á€¬á€„á€ºá€€ á€™á€¾á€¬á€¸á€šá€½á€„á€ºá€¸á€”á€±á€á€šá€ºá‹ á€œá€±á€‘á€¯á€‘á€²á€™á€¾á€¬ á€žá€¶á€á€»á€±á€¸á€”á€¶á€·á€œá€­á€¯á€œá€­á€¯ á€›á€”á€±á€á€šá€ºá‹" }
                }
            ],
            choices: [
                { text: { en: "Look around", mm: "á€•á€á€ºá€á€”á€ºá€¸á€€á€»á€„á€ºá€€á€­á€¯ á€€á€¼á€Šá€·á€ºá€™á€Šá€º" }, next: 'parallel_home_journey' },
                { text: { en: "Go Home immediately", mm: "á€¡á€­á€™á€ºá€€á€­á€¯á€á€»á€€á€ºá€á€»á€„á€ºá€¸á€•á€¼á€”á€ºá€™á€Šá€º" }, next: 'parallel_home_journey' }
            ]
        },

        'parallel_home_journey': {
            bg: 'parallel_street',
            world: 'parallel',
            location: { en: 'Downtown', mm: 'á€™á€¼á€­á€¯á€·á€‘á€²' },
            time: 'UNKNOWN',
            steps: [
                {
                    bg: 'parallel_street',
                    text: { en: "I rush towards home. People are walking on the street, but...", mm: "á€¡á€­á€™á€ºá€˜á€€á€ºá€€á€­á€¯ á€¡á€™á€¼á€”á€ºá€•á€¼á€±á€¸á€œá€¬á€á€²á€·á€á€šá€ºá‹ á€œá€™á€ºá€¸á€•á€±á€«á€ºá€™á€¾á€¬ á€œá€°á€á€½á€±á€žá€½á€¬á€¸á€œá€¬á€”á€±á€€á€¼á€á€šá€ºáŠ á€’á€«á€•á€±á€™á€šá€·á€º..." }
                },
                {
                    text: { en: "Their faces. They are blurry. Distorted. Not Burmese. Not human.", mm: "á€žá€°á€á€­á€¯á€·á€™á€»á€€á€ºá€”á€¾á€¬á€á€½á€±á‹ á€á€«á€¸á€”á€±á€á€šá€ºá‹ á€›á€¯á€•á€ºá€•á€»á€€á€ºá€†á€„á€ºá€¸á€•á€»á€€á€ºá€–á€¼á€…á€ºá€”á€±á€á€šá€ºá‹ á€™á€¼á€”á€ºá€™á€¬á€œá€°á€™á€»á€­á€¯á€¸á€á€½á€±á€™á€Ÿá€¯á€á€ºá€˜á€°á€¸á‹ á€œá€°á€á€½á€±á€”á€²á€·á€™á€á€°á€˜á€°á€¸á‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "What is happening? Am I dreaming?", mm: "á€˜á€¬á€á€½á€±á€–á€¼á€…á€ºá€”á€±á€á€¬á€œá€²á‹ á€„á€«á€¡á€­á€™á€ºá€™á€€á€ºá€™á€€á€ºá€”á€±á€á€¬á€œá€¬á€¸á‹" }
                },
                {
                    text: { en: "I reach my house door. I knock desperately.", mm: "á€¡á€­á€™á€ºá€›á€¾á€±á€·á€›á€±á€¬á€€á€ºá€á€±á€¬á€· á€á€¶á€á€«á€¸á€€á€­á€¯ á€¡á€¬á€¸á€€á€¯á€”á€ºá€‘á€¯á€œá€­á€¯á€€á€ºá€á€šá€ºá‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "Mom! Dad! Open the door!", mm: "á€¡á€™á€±! á€¡á€–á€±! á€á€¶á€á€«á€¸á€–á€½á€„á€·á€ºá€•á€«á€¦á€¸!" }
                }
            ],
            choices: [
                { text: { en: "Wait for answer", mm: "á€á€¶á€á€«á€¸á€–á€½á€„á€·á€ºá€™á€Šá€·á€ºá€žá€°á€€á€­á€¯ á€…á€±á€¬á€„á€·á€ºá€™á€Šá€º" }, next: 'parallel_home_door' }
            ]
        },

        'parallel_home_door': {
            bg: 'home_tayza',
            world: 'parallel',
            location: { en: 'Home', mm: 'Home' },
            time: 'UNKNOWN',
            steps: [
                {
                    audio: 'kitchen',
                    text: { en: "The door creaks open.", mm: "á€á€¶á€á€«á€¸ á€€á€»á€½á€®á€€á€”á€² á€•á€½á€„á€·á€ºá€œá€¬á€á€šá€ºá‹" }
                },
                {
                    speaker: SPEAKERS.mom,
                    text: { en: "You're late, Tayza. Where have you been?", mm: "á€”á€±á€¬á€€á€ºá€€á€»á€œá€­á€¯á€€á€ºá€á€¬ á€á€±á€‡á€›á€šá€ºá‹ á€˜á€šá€ºá€á€½á€±á€žá€½á€¬á€¸á€”á€±á€á€¬á€œá€²á‹" }
                },
                {
                    text: { en: "The voice is my mother's. The clothes are hers.", mm: "á€¡á€žá€¶á€€ á€¡á€™á€±á€›á€²á€·á€¡á€žá€¶á‹ á€¡á€á€á€ºá€¡á€…á€¬á€¸á€á€½á€±á€€ á€¡á€™á€±á€á€á€ºá€”á€±á€€á€»á‹" }
                },
                {
                    bg: 'faceless_mom',
                    char: 'faceless_mom',
                    text: { en: "But when I look up... there is no face. Just smooth skin.", mm: "á€’á€«á€•á€±á€™á€šá€·á€º á€™á€±á€¬á€·á€€á€¼á€Šá€·á€ºá€œá€­á€¯á€€á€ºá€á€²á€·á€¡á€á€«... á€™á€»á€€á€ºá€”á€¾á€¬á€™á€›á€¾á€­á€˜á€°á€¸á‹ á€•á€¼á€±á€¬á€„á€ºá€á€»á€±á€¬á€”á€±á€á€²á€· á€¡á€›á€±á€•á€¼á€¬á€¸á€•á€² á€›á€¾á€­á€á€šá€ºá‹" }
                },
                {
                    speaker: SPEAKERS.tayza,
                    text: { en: "AHHHHHH!", mm: "á€¡á€¬á€¬á€¸á€¸á€¸á€¸á€¸á€¸á€¸!" }
                }
            ],
            choices: [
                { text: { en: "RUN AWAY", mm: "á€‘á€½á€€á€ºá€•á€¼á€±á€¸á€™á€Šá€º" }, type: "danger", next: 'run_away_meet_naychi' }
            ]
        },

        'run_away_meet_naychi': {
            bg: 'parallel_street',
            world: 'parallel',
            location: { en: 'Alleyway', mm: 'á€œá€™á€ºá€¸á€€á€¼á€¬á€¸' },
            time: 'UNKNOWN',
            steps: [
                {
                    clearChar: true,
                    text: { en: "I run blindly into the dark alleyway. My heart is pounding out of my chest.", mm: "á€™á€¾á€±á€¬á€„á€ºá€™á€²á€”á€±á€á€²á€· á€œá€™á€ºá€¸á€€á€¼á€¬á€¸á€‘á€²á€€á€­á€¯ á€¡á€á€„á€ºá€¸á€•á€¼á€±á€¸á€á€„á€ºá€œá€­á€¯á€€á€ºá€á€šá€ºá‹ á€›á€„á€ºá€˜á€á€ºá€‘á€²á€€ á€”á€¾á€œá€¯á€¶á€¸á€á€¯á€”á€ºá€žá€¶á€€ á€¡á€•á€¼á€„á€ºá€›á€±á€¬á€€á€ºá€á€±á€¬á€·á€™á€á€á€ºá€•á€²á‹" }
                },
                {
                    text: { en: "I bump into someone.", mm: "á€á€…á€ºá€šá€±á€¬á€€á€ºá€šá€±á€¬á€€á€ºá€”á€²á€· á€á€„á€ºá€á€­á€¯á€€á€ºá€™á€­á€á€šá€ºá‹" }
                },
                {
                    speaker: SPEAKERS.unknown,
                    text: { en: "Shhh! Keep it down if you want to live.", mm: "á€›á€¾á€°á€¸... á€¡á€žá€€á€ºá€›á€¾á€„á€ºá€á€»á€„á€ºá€›á€„á€º á€á€­á€¯á€¸á€á€­á€¯á€¸á€”á€±á‹" }
                },
                {
                    bg: 'parallel_street',
                    char: 'naychi',
                    speaker: SPEAKERS.nay,
                    text: { en: "Welcome to the Echo Yangon. I'm Nay Chi.", mm: "á€•á€²á€·á€á€„á€ºá€žá€¶á€›á€”á€ºá€€á€¯á€”á€ºá€€á€”á€± á€€á€¼á€­á€¯á€†á€­á€¯á€•á€«á€á€šá€ºá‹ á€„á€«á€·á€”á€¬á€™á€Šá€º á€”á€±á€á€¼á€Šá€ºá‹" }
                }
            ],
            choices: [
                { text: { en: "To Be Continued...", mm: "á€†á€€á€ºá€›á€”á€º..." }, next: 'start' }
            ]
        },
    };
    // --- BOOTSTRAP ---
    const game = new GameEngine();
    
    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();
    });
    
    document.addEventListener('contextmenu', event => event.preventDefault());

</script>
    </body>
</html>